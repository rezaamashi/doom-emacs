#+TITLE: Reza's Personal Emacs Configuration
#+AUTHOR: Reza A'masyi
#+EMAIL: mnurrreza@gmail.com
#+STARTUP: fold
# #+SETUPFILE: https://fniessen.github.io/org-html-themes/org/theme-readtheorg.setup
#+PROPERTY: header-args :emacs-lisp :tangle config.el :mkdirp yes

* Rudimentary configuration
Make this file run (slightly) faster with lexical binding (see [[https://nullprogram.com/blog/2016/12/22/][this blog post]]
for more info).
#+begin_src emacs-lisp :comments no
;;; $DOOMDIR/config.el -*- lexical-binding: t; -*-
#+end_src

** Fix for defvar-keymap provided by compat-29
Ensure that we have the latest compat package
#+begin_src emacs-lisp :tangle packages.el
(package! compat
  :recipe (:host github
           :repo "emacs-compat/compat"
           :files ("*.el")))
#+end_src

** Log level and Debugging
I set the log warning level to higher since =org-element= keep throwing warning in =org-roam=
#+begin_src emacs-lisp
(setq! log-warning-minimum-level :error) ;;default :warning

;; Enable debugging for more information on the error
(map! :leader
      :desc "Toggle debug on error" "d" #'toggle-debug-on-error)
#+end_src

** Bookmark Saving Configuration
Set up emacs to save bookmark on every modification of =bookmark-alist=
#+begin_src emacs-lisp
(setq bookmark-save-flag 1)
#+end_src

** Open video url in MPV
This is taken from [[https://gist.github.com/bsless/19ca4a37eee828b1b62c84971181f506][Opening YouTube Links In MPV from Emacs Â· GitHub]]
#+begin_src emacs-lisp
(defun rz/mpv-play-url (url &rest args)
  "Play video url using `mpv' with `yt-dlp'"
  (interactive)
  (start-process "mpv" nil "mpv" url))

(setq browse-url-browser-function
    '(("youtu\\.?be" . rz/mpv-play-url)
      ("www\\.youtube\\.com" . rz/mpv-play-url)
      ("." . browse-url-default-browser)))
#+end_src

** COMMENT Macro to set up ~setq~ differently in wayland and x11
This macro still not working the way how I want it to be
#+begin_src emacs-lisp
(defmacro rz/setq-display (var val-wayland val-x11)
  "Allow user to specifically `setq' variables for specific display"
  `(setq ,var (if (string-equal (getenv "XDG_SESSION_TYPE") "wayland")
                 ,val-wayland
                 ,val-x11)))
#+end_src

* Workflows Variables
This next line is used to call the variables into ~config.el~
#+begin_src emacs-lisp
(load-file (expand-file-name "elisp/variables.el" doom-private-dir))
#+end_src

** Variable Setup
:PROPERTIES:
:header-args: :emacs-lisp :tangle ./elisp/variables.el :mkdirp yes
:END:
This setup is placed in a different file from the ~config.el~ for easier access with multiple init files. Especially for ~org-export-async-init-file~.

*** User Credentials
#+begin_src emacs-lisp
(setq user-full-name "Reza A'masyi"
      user-mail-address "mnurrreza@gmail.com")
#+end_src

*** Org Mode Features
#+begin_src emacs-lisp
  (defvar org_file_dir (concat (getenv "HOME") "/org/"))
  (defvar org_agenda_dir (concat (getenv "HOME") "/org/Orgzly/"))

;; Org journal weekly review
  (defvar org_journal_weekly_dir (concat (getenv "HOME") "/org/journals/weekly/"))
#+end_src
*** Finance
#+begin_src emacs-lisp
(defvar hledger_journal_dir (concat (getenv "HOME") "/org/hledger/"))
#+end_src

*** Zettelkasten Setup
This variable is set to make a more streamlined Zettelkasten workflow
#+begin_src emacs-lisp
  (defvar org_journal (concat (getenv "HOME") "/org/journals/"))
  (defvar org_noter (concat (getenv "HOME") "/org/roam/noter"))
  (defvar org_roam (concat (getenv "HOME") "/org/roam/"))
  (defvar bib_notes (concat (getenv "HOME") "/org/roam/bib_notes/bib_notes.org"))
  (defvar bib_dir (concat (getenv "HOME") "/Documents/Reza/BibTex/Zotero-mylib/"))
  (defvar bib_files `(,(concat bib_dir "CalibreBib.bib")
                      ,(concat bib_dir "Zotero-mylib.bib")))
  (defvar zot_col (concat bib_dir "files/Input"))
#+end_src

*** Project Directory
#+begin_src emacs-lisp
  (defvar proj_dir (concat (getenv "HOME") "/Documents/Reza/Project"))
  (defvar proj_file (expand-file-name "projectile/projectile.projects"  doom-private-dir))
#+end_src

*** Email
#+begin_src emacs-lisp
  (defvar draft_dir (concat (getenv "HOME") "/Maildir/draft/"))
  (defvar mail_dir (concat (getenv "HOME") "/Maildir/"))
  (defvar mail_script (concat (getenv "HOME") "/.local/script/email"))
#+end_src

** Dotfiles Git-Bare

*** Configuration
#+begin_src emacs-lisp
(setq bare_git_dir (concat "--git-dir=" (expand-file-name "~/.dotfiles")))
(setq bare_work_tree (concat "--work-tree=" (expand-file-name "~")))
;; use maggit on git bare repos like dotfiles repos, don't forget to change `bare-git-dir' and `bare-work-tree' to your needs
(defun rz/magit-status-dotfiles-bare ()
  "set --git-dir and --work-tree in `magit-git-global-arguments' to `bare-git-dir' and `bare-work-tree' and calls `magit-status'"
  (interactive)
  (use-package! magit-git)
  (add-to-list 'magit-git-global-arguments bare_git_dir)
  (add-to-list 'magit-git-global-arguments bare_work_tree)
  (call-interactively 'magit-status))

;; if you use `rz/magit-status-bare' you cant use `magit-status' on other other repos you have to unset `--git-dir' and `--work-tree'
;; use `rz/magit-status' insted it unsets those before calling `magit-status'
(defun rz/magit-status ()
  "removes --git-dir and --work-tree in `magit-git-global-arguments' and calls `magit-status'"
  (interactive)
  (use-package! magit-git)
  (setq magit-git-global-arguments (remove bare_git_dir magit-git-global-arguments))
  (setq magit-git-global-arguments (remove bare_work_tree magit-git-global-arguments))
  (call-interactively 'magit-status))
#+end_src

*** Keybinding
#+begin_src emacs-lisp
(map! :leader
      :desc "Git dotfiles" "g d" #'rz/magit-status-dotfiles-bare
      :desc "Magit status" "g g" #'rz/magit-status)
#+end_src

* UI Settings

** Fonts

*** Daemon Configuration For Typeface and Size
This config is needed to load faces when emacs is running in daemon
#+begin_src emacs-lisp
    (defvar rz/default-font-size 105)
    (defvar rz/default-variable-font-size 105)

  (defun rz/set-font-faces ()
    (message "Setting faces!")
    (set-face-attribute 'default nil :font "Iosevka" :height rz/default-font-size)

    ;; Set the fixed pitch face
    (set-face-attribute 'fixed-pitch nil :font "Iosevka" :height rz/default-font-size)

    ;; Set the variable pitch face
    (set-face-attribute 'variable-pitch nil :font "Fira Sans" :height rz/default-variable-font-size :weight 'regular))

  (if (daemonp)
        (add-hook 'after-make-frame-functions
                  (lambda (frame)
                    (setq doom-modeline-icon t)
                    (with-selected-frame frame
                      (rz/set-font-faces))))
        (rz/set-font-faces))
#+end_src

*** Doom font Configuration
#+begin_src emacs-lisp
(setq doom-font (font-spec :family "Iosevka" :size 15)
      doom-big-font (font-spec :family "Iosevka" :size 36)
      doom-variable-pitch-font (font-spec :family "Overpass" :size 18)
      doom-unicode-font (font-spec :family "Iosevka")
      doom-serif-font (font-spec :family "Bookerly" :weight 'light))
#+end_src

*** Mixed-Pitch
#+begin_src emacs-lisp
  (use-package! mixed-pitch
    :config
    ;; If you want it in all text modes:
    (add-hook 'text-mode-hook 'mixed-pitch-mode))
#+end_src

** Theme
I use ~theme.el~ so that emacs theme could be uniformly riced with the rest of my WM.
#+begin_src emacs-lisp
(load-file (expand-file-name "elisp/theme.el" doom-private-dir))
#+end_src

*** Extra Themes

**** Catppuccin
***** Installation
#+begin_src emacs-lisp :tangle packages.el
(package! catppuccin-theme
  :recipe (:host github
           :repo "catppuccin/emacs"))
#+end_src

***** Configuration
#+begin_src emacs-lisp
(use-package! catppuccin-theme
  :config
  (setq catppuccin-flavor 'frappe)) ;; frappe, latte, macchiato, and mocha
#+end_src
** Time Display Configuration
#+begin_src emacs-lisp
(setq display-time-24hr-format t)
#+end_src

** Hide Mode line
#+begin_src emacs-lisp
(map! :leader
      :desc "Hide mode-line"
      "t m" #'hide-mode-line-mode)
#+end_src

** Line Numbering
#+begin_src emacs-lisp
    ;; line numbering
    (column-number-mode)
    (global-display-line-numbers-mode t)
    (setq display-line-numbers-type 'relative)


  ;; disable line number for certain modes
  (dolist (no-line-mode '(org-mode-hook
                          org-agenda-mode-hook
                          term-mode-hook
                          pdf-view-mode-hook
                          shell-mode-hook
                          vterm-mode-hook
                          treemacs-mode-hook
                          eshell-mode-hook
                          nov-mode-hook
                          doc-view-mode-hook
                          image-mode-hook
                          notmuch-hello-mode-hook
                          elfeed-show-mode-hook))
    (add-hook! no-line-mode (lambda () (display-line-numbers-mode 0))))
#+end_src

* Navigation

** Minibuffer binding
#+begin_src emacs-lisp
  (map! :map minibuffer-mode-map
         "C-h" #'evil-delete-backward-char-and-join)
#+end_src

** Ivy
#+begin_src emacs-lisp
(map! :after evil
      :map ivy-minibuffer-map
       "TAB" #'ivy-alt-done
       "C-l" #'ivy-immediate-done
       "C-h" #'ivy-backward-delete-char
       "C-j" #'ivy-next-line
       "C-k" #'ivy-previous-line
      :map ivy-switch-buffer-map
       "C-k" #'ivy-previous-line
       "C-l" #'ivy-done
       "C-d" #'ivy-switch-buffer-kill
      :map ivy-reverse-i-search-map
       "C-k" #'ivy-previous-line
       "C-d" #'ivy-reverse-i-search-kill)

(define-key! "C-s" #'swiper)
#+end_src

** Evil
#+begin_src emacs-lisp
(after! evil
  :config
  (define-key! evil-insert-state-map (kbd "C-g") 'evil-normal-state)
  (define-key! evil-insert-state-map (kbd "C-h") 'evil-delete-backward-char-and-join)

  ; use visual line motions even outside of visual-line-mode buffers
  (evil-global-set-key 'motion "j" 'evil-next-visual-line)
  (evil-global-set-key 'motion "k" 'evil-previous-visual-line))
#+end_src

* Developments

** Language Server (lsp-mode)

*** Configuration
#+begin_src emacs-lisp
  (defun rz/lsp-mode-setup ()
    (setq lsp-headerline-breadcrumb-segments '(path-up-to-project file symbols))
    (lsp-headerline-breadcrumb-mode)

    (use-package! lsp-mode
      :commands (lsp lsp-deferred)
      ;; :bind-keymap
      ;; ("s-m" . lsp-command-map)
      :hook (lsp-mode . (lambda () (rz/lsp-mode-setup)))
      :config
      (setq lsp-keymap-prefix "C-c l")  ;; Or 'C-c l' 'C-l', 's-l'
      (setq lsp-enable-which-key-integration t
            read-process-output-max (* 1024 1024)
            lsp-idle-delay 0.5)))
#+end_src

*** More Information (lsp-ui)
#+begin_src emacs-lisp
  (use-package! lsp-ui
    :hook (lsp-mode . (lambda () (lsp-ui-mode)))
    :init
    (general-setq lsp-ui-doc-enable nil)
    :custom
    (lsp-ui-doc-position 'bottom))
#+end_src

*** Ivy Integration (lsp-ivy)
#+begin_src emacs-lisp
  (use-package! lsp-ivy
    :after lsp-mode)
#+end_src

*** Tree Layout Project Files Manager (lsp-treemacs)
#+begin_src emacs-lisp
  (use-package! lsp-treemacs
    :after lsp)
#+end_src

** Languages

*** Terraform

**** Configuration
#+begin_src emacs-lisp
  (after! lsp
    (add-to-list 'lsp-language-id-configuration '(terraform-mode . "terraform"))

    (lsp-register-client
     (make-lsp-client :new-connection (lsp-stdio-connection '("usr/bin/terraform-lsp" "-enable-log-file")) ;; installed from AUR
                      :major-modes '(terraform-mode)
                      :server-id 'terraform-ls))

    (add-hook 'terraform-mode-hook #'lsp))
#+end_src

*** TypeScript

**** Configuration
#+begin_src emacs-lisp
  (use-package! typescript-mode
    :mode "\\.ts\\'"
    :hook (typescript-mode . (lambda () (lsp-deferred)))
    :config
    (setq typescript-indent-level 2))
#+end_src

*** Crontab

**** Configuration
#+begin_src emacs-lisp
  (use-package! crontab-mode
    :defer t)
#+end_src

*** Git Files

**** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! git-modes)
#+end_src

**** Configuration
#+begin_src emacs-lisp
  (use-package! git-modes
    :config
    (add-to-list 'auto-mode-alist
                 (cons "/.dockerignore\\'" 'gitignore-mode)))
#+end_src

*** GraphQL

**** Installation
#+begin_src emacs-lisp :tangle packages.el
(package! graphql-mode)
#+end_src

**** Configuration
#+begin_src emacs-lisp
  (use-package! graphql-mode
    :hook (graphql-mode . (lambda () (lsp-deferred)))
    :mode "\\.graphql\\'")
#+end_src

*** LaTeX

**** COMMENT Configuration
#+begin_src emacs-lisp
  (use-package! lsp-latex
    :hook ((tex-mode
            latex-mode
            yatex-mode
            bibtex-mode) . lsp)
    :config
    (setq lsp-latex-texlab-executable "texlab")
    ;; (setq tex-command "platex --synctex=1")
    (setq tex-command "latexmk -pdflatex='pdflatex -shell-escape -interaction nonstopmode' -pdf -bibtex -f %f")
    ;; Setting for pdf-tools
    (setq lsp-latex-forward-search-executable "emacsclient")
    (setq lsp-latex-forward-search-args
          '("--eval"
            "(lsp-latex-forward-search-with-pdf-tools \"%f\" \"%p\" \"%l\")")))
#+end_src

**** Preview Pane

***** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! latex-preview-pane)
#+end_src

***** Configuration
#+begin_src emacs-lisp
  (use-package! latex-preview-pane
    :hook ((tex-mode
            latex-mode
            yatex-mode) . (lambda () (latex-preview-pane-mode))))
#+end_src

*** Markdown

**** Configuration
#+begin_src emacs-lisp
  (use-package! markdown-mode
    ;; :mode ("README\\.md\\'" . gfm-mode)
    :init (setq markdown-command "multimarkdown"))
#+end_src

*** Python

**** Configuration
    #+begin_src emacs-lisp
      (use-package! python-mode
        :defer t)
    #+end_src

**** Pyright Integration
#+begin_src emacs-lisp
(use-package! lsp-pyright)
  ;; :hook (python-mode . (lambda ()
                          ;; (require 'lsp-pyright)
                          ;; (lsp))  ; or lsp-deferred
#+end_src

*** Web-Mode

**** Configuration
#+begin_src emacs-lisp
  (use-package! web-mode
    :hook ((web-mode . lsp-deferred))
    ;; :mode ("\\.phtml\\'"
    ;;         "\\.tpl\\.php\\'"
    ;;         "\\.[agj]sp\\'"
    ;;         "\\.as[cp]x\\'"
    ;;         "\\.erb\\'"
    ;;         "\\.mustache\\'"
    ;;         "\\.djhtml\\'"
    ;;         "\\.html?\\'"
    ;;         "\\.css\\'"
    ;;         "\\.json\\'"
    ;;         "\\.tsx\\'")
    :config
          ;; Indentations
    (setq web-mode-markup-indent-offset 2
          web-mode-css-indent-offset 2
          web-mode-code-indent-offset 2
          ;; Features
          web-mode-enable-css-colorization t
          web-mode-enable-block-face t
          web-mode-enable-part-face t
          web-mode-enable-comment-interpolation t
          web-mode-enable-auto-pairing t
          web-mode-enable-heredoc-fontification t
          web-mode-enable-current-element-highlight t
          web-mode-enable-current-column-highlight t))
#+end_src

*** YAML files

**** Configuration
#+begin_src emacs-lisp
  (use-package! yaml-mode
    :defer t)
    ;; :hook (yaml-mode . (lambda())))
                         ;; (highlight-indent-guides-mode)
                         ;; (lsp-deferred))
#+end_src

** Tree-Sitter

*** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! tree-sitter)
  (package! tree-sitter-langs)
#+end_src

*** Configuration
#+begin_src emacs-lisp
  (use-package! tree-sitter
    :custom-face
    ;; (tree-sitter-hl-face:method.call   ((t (:inherit font-lock-function-name-face))))
    ;; (tree-sitter-hl-face:function.call ((t (:inherit font-lock-function-name-face))))
    ;; (tree-sitter-hl-face:operator      ((t (:inherit default))))
    ;; (tree-sitter-hl-face:type.builtin  ((t (:inherit font-lock-type-face))))
    ;; (tree-sitter-hl-face:number        ((t (:inherit highlight-numbers-number))))
    :config
    (global-tree-sitter-mode)
    (add-hook 'tree-sitter-after-on-hook #'tree-sitter-hl-mode))

  (use-package! tree-sitter-langs
    :after tree-sitter)
#+end_src

** Project Management (projectile)

*** Configuration
#+begin_src emacs-lisp
  (use-package! projectile
    :diminish projectile-mode
    :config (projectile-mode)
    :custom
    (projectile-completion-system 'ivy)
    :init
    ;; note: set this to the folder where you keep your git repos!
    (when (file-directory-p (expand-file-name proj_dir))
      (setq projectile-project-search-path '("~/Documents/Reza/Project")))
    (setq projectile-switch-project-action #'projectile-dired)
    (setq projectile-enable-caching t))
#+end_src

*** Exclude Homedir
#+begin_src emacs-lisp
(after! projectile (setq projectile-project-root-files-bottom-up (remove
            ".git" projectile-project-root-files-bottom-up)))
#+end_src

*** Extension

**** Counsel-Projectile
Open projectile using ivy
#+begin_src emacs-lisp
(use-package! counsel-projectile
  :after projectile
  :config (counsel-projectile-mode +1))
#+end_src

** Snippets

*** yasnippet

**** Configuration
#+begin_src emacs-lisp
  (use-package! yasnippet
    :config
    ;; (setq 'yas-snippet-dirs
    ;;       '("~/.config/doom/snippets/"))
    (setq yas-triggers-in-field t)
    (yas-global-mode 1))

  (after! yasnippet
      (add-hook 'yas-minor-mode-hook (lambda ()
                                      (yas-activate-extra-mode 'fundamental-mode))))
#+end_src

**** Quick Snippets (auto-yasnippet)
#+begin_src emacs-lisp
  (use-package! auto-yasnippet
    :after yasnippet)
#+end_src

*** emmet-mode
Package to improve HTML and CSS snippets

**** Configuration
#+begin_src emacs-lisp
  (use-package! emmet-mode
    :hook (web-mode . (lambda () (emmet-mode))))
#+end_src

** Code Formatter (format-all)

*** Configuration
#+begin_src emacs-lisp
  (use-package! format-all
    ;; :preface
    ;; (defun ian/format-code ()
    ;;   "Auto-format whole buffer."
    ;;   (interactive)
    ;;   (if (derived-mode-p 'prolog-mode)
    ;;       (prolog-indent-buffer)
    ;;     (format-all-buffer)))
    :hook (prog-mode . (lambda () (format-all-mode))))
    ;; :config)
    ;; (global-set-key (kbd "M-F") #'ian/format-code)
    ;; (add-hook 'format-all-mode-hook #'format-all-ensure-formatter))
#+end_src

*** Exclude certain Modes
Sometimes when forking code from somewhere else you would need to keep original formatting
#+begin_src emacs-lisp
  (dolist (mode '(c-mode-hook))
   (add-hook mode (lambda () (format-all-mode 0))))
#+end_src

** Indent Guide (highlight-indent-guides)

**** Configuration
#+begin_src emacs-lisp
  (use-package! highlight-indent-guides
    :hook ((prog-mode conf-mode) . (lambda () (highlight-indent-guides-mode)))
    :init
    (setq highlight-indent-guides-method 'character
          highlight-indent-guides-suppress-auto-error t)
    :config
    (set-face-background 'highlight-indent-guides-odd-face "darkgray")
    (set-face-background 'highlight-indent-guides-even-face "dimgray")
    (set-face-foreground 'highlight-indent-guides-character-face "dimgray"))
#+end_src

** Version Control (magit)
  Magit for version managements

*** Configuration
#+begin_src emacs-lisp
  (use-package! magit
    :commands magit-status
    :config
    (setq magit-diff-refine-hunk 'all)
    :custom
    (magit-display-buffer-function #'magit-display-buffer-same-window-except-diff-v1))
#+end_src

***** Magit Submodules
#+begin_src emacs-lisp
(after! magit-status
  (setq magit-submodule-list-columns
        '((("Path" 50 magit-modulelist-column-path nil)
           ("Version" 25 magit-repolist-column-version nil)
           ("Branch" 20 magit-repolist-column-branch nil)
           ("B<U" 3 magit-repolist-column-unpulled-from-upstream
            ((:right-align t)))
           ("B>U" 3 magit-repolist-column-unpushed-to-upstream
            ((:right-align t)))
           ("B<P" 3 magit-repolist-column-unpulled-from-pushremote
            ((:right-align t)))
           ("B>P" 3 magit-repolist-column-unpushed-to-pushremote
            ((:right-align t)))
           ("B" 3 magit-repolist-column-branches
            ((:right-align t)))
           ("S" 3 magit-repolist-column-stashes
            ((:right-align t)))))))
#+end_src
**** Bug fix
Problem with =magit-rebase= menu caused by unsupported =project.el= in =emacs v.27=. This fix comes from [[https://www.reddit.com/r/emacs/comments/po9cfj/magit_commands_broken/][Reddit - Comments]].
#+begin_src emacs-lisp
  (after! magit
    (setq project-switch-commands t))
#+end_src

*** COMMENT Smerge-Mode

**** Configuration :hookproblem:
#+begin_src emacs-lisp
  (use-package! smerge-mode
    :preface)
  (defun rz/try-smerge ()
    (save-excursion
      (goto-char (point-min))
      (when (re-search-forward "^<<<<<<< " nil t)
        (smerge-mode 1))))
    :after magit
    :config
    (add-hook! 'find-file-hook 'rz/try-smerge t)
    :hook (magit-diff-visit-file . (lambda () (when smerge-mode (rz/smerge-hydra/body))))
#+end_src

**** Hydra Binding
#+begin_src emacs-lisp
  (defhydra rz/smerge-hydra
      (:color pink :hint nil :post (smerge-auto-leave))
      "
  ^Move^       ^Keep^               ^Diff^                 ^Other^
  ^^-----------^^-------------------^^---------------------^^-------
  _n_ext       _b_ase               _<_: upper/base        _C_ombine
  _p_rev       _u_pper              _=_: upper/lower       _r_esolve
  ^^           _l_ower              _>_: base/lower        _k_ill current
  ^^           _a_ll                _R_efine
  ^^           _RET_: current       _E_diff
  "
      ("n" smerge-next)
      ("p" smerge-prev)
      ("b" smerge-keep-base)
      ("u" smerge-keep-upper)
      ("l" smerge-keep-lower)
      ("a" smerge-keep-all)
      ("RET" smerge-keep-current)
      ("\C-m" smerge-keep-current)
      ("<" smerge-diff-base-upper)
      ("=" smerge-diff-upper-lower)
      (">" smerge-diff-base-lower)
      ("R" smerge-refine)
      ("E" smerge-ediff)
      ("C" smerge-combine-with-next)
      ("r" smerge-resolve)
      ("k" smerge-kill-current)
      ("ZZ" (lambda ()
              (interactive)
              (save-buffer)
              (bury-buffer))
       "Save and bury buffer" :color blue)
      ("q" nil "cancel" :color blue))
#+end_src



***** Configuration

**** Extensions

***** Forge

****** Configuration
#+begin_src emacs-lisp
  (use-package! forge
    :after magit)
#+end_src

***** Github-Review

****** Configuration
#+begin_src emacs-lisp
  (use-package! github-review)
#+end_src

****** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! github-review :recipe
     (:host github
      :repo "charignon/github-review"
      :files ("github-review.el")))
#+end_src

**** Shows TODOs (magit-todos)
***** Git-Timemachine

***** Configuration
#+begin_src emacs-lisp
  (use-package! magit-todos
    :after magit
    :hook
    (magit-mode . (lambda () (magit-todos-mode))))
#+end_src


****** Configuration
#+begin_src emacs-lisp
  (use-package! git-timemachine
    :after magit)
#+end_src

****** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! git-timemachine)
#+end_src

***** Open Code in Remote (browse-at-remote)

****** Configuration
#+begin_src emacs-lisp
  (use-package! browse-at-remote
    :commands
    (browse-at-remote
     browse-at-remote-kill)
    :config
    (evil-define-key 'normal 'prog-mode-map
      (kbd "g D") #'browse-at-remote))
#+end_src

***** Git-Gutter-Fringe
Show changes in gutter fringe

****** Configuration
#+begin_src emacs-lisp
  (use-package! git-gutter-fringe
    :hook
    (prog-mode . (lambda () (git-gutter-mode))))
#+end_src

***** Git-messenger

****** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! git-messenger)
#+end_src

****** Configuration
#+begin_src emacs-lisp
  (use-package! git-messenger
    :commands (git-messenger:popup-message))
#+end_src

*** COMMENT Completion (company)

**** Configuration
#+begin_src emacs-lisp
  (use-package! company
    :after lsp-mode
    :hook (lsp-mode . (lambda () (company-mode)))
    :bind
    (:map company-active-map
          ("<tab>" . company-complete-selection)
          ("C-h" . evil-delete-backward-char-and-join)
          ("C-g" . evil-normal-state)
     :map lsp-mode-map
          ("<tab>" . company-indent-or-complete-common))
    :config
    (setq company-minimum-prefix-length 1
          company-idle-delay 0
          company-tooltip-align-annotations t))
          ;; company-show-quick-access t))
          ;; company-frontends '(company-tng-frontend company-box-frontend)
          ;; company-backends '(company-bbdb company-semantic company-cmake company-clang company-files
                             ;; (company-dabbrev-code company-gtags company-etags company-keywords)
                             ;; company-oddmuse company-dabbrev))
#+end_src

**** Expansions

***** Sorting Completions (company-prescient)

****** Configuration
#+begin_src emacs-lisp
  (use-package! company-prescient
    :requires (prescient)
    :hook (company-mode . (lambda () (company-prescient-mode))))
#+end_src


****** Configuration
#+begin_src emacs-lisp
  (use-package! company-dict
    :config
    (setq company-dict-dir (concat doom-private-dir "dict/"))
    )
#+end_src

***** Org-Block (company-org-block)

****** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! company-org-block)
#+end_src

****** Configuration
#+begin_src emacs-lisp
  (use-package! company-org-block
    :after org
    :custom
    (setq company-org-block-edit-style 'inline) ;; 'auto, 'prompt, or 'inline
    )
#+end_src

***** Company Math-Latex

****** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! company-math :recipe
          (:type git
           :host github
           :repo "vspinu/company-math"))
#+end_src

****** Configuration
#+begin_src emacs-lisp
  (use-package! company-math
    :after company)
#+end_src

**** COMMENT Tabnine Integration

****** Configuration
#+begin_src emacs-lisp
  (use-package! company-tabnine
    :after company
    :config
    (add-to-list 'company-backends #'company-tabnine))
#+end_src

** Debugger (dap-mode)

*** Configuration
#+begin_src emacs-lisp
(use-package! dap-mode
  ;; Uncomment the config below if you want all UI panes to be hidden by default!
  ;; :custom
  ;; (lsp-enable-dap-auto-configure nil)
  ;; :config
  ;; (dap-ui-mode 1)
  :commands dap-debug
  :config
  ;; Set up Node debugging
  (require 'dap-node)
  (dap-node-setup)) ;; Automatically installs Node debug adapter if needed

  ;; Bind `C-c l d` to `dap-hydra` for easy access
  ;; (general-define-key
  ;;   :keymaps 'lsp-mode-map
  ;;   :prefix lsp-keymap-prefix
  ;;   "d" '(dap-hydra t :wk "debugger")))
#+end_src

*** Terminal (vterm)

*** Configurations
#+begin_src emacs-lisp
  (use-package! vterm
    :commands vterm)
    ;; :bind ("C-c v" . vterm-other-window))
#+end_src

**** Extensions

***** Multi-Vterm

****** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! multi-vterm)
#+end_src

***** Configuration
#+begin_src emacs-lisp
  (use-package! multi-vterm
          :config
          (add-hook 'vterm-mode-hook
                          (lambda ()
                          (setq-local evil-insert-state-cursor 'box)
                          (evil-insert-state)))
          (define-key vterm-mode-map [return]                      #'vterm-send-return)

          (setq vterm-keymap-exceptions nil)
          (evil-define-key 'insert vterm-mode-map (kbd "C-e")      #'vterm--self-insert)
          (evil-define-key 'insert vterm-mode-map (kbd "C-f")      #'vterm--self-insert)
          (evil-define-key 'insert vterm-mode-map (kbd "C-a")      #'vterm--self-insert)
          (evil-define-key 'insert vterm-mode-map (kbd "C-v")      #'vterm--self-insert)
          (evil-define-key 'insert vterm-mode-map (kbd "C-b")      #'vterm--self-insert)
          (evil-define-key 'insert vterm-mode-map (kbd "C-w")      #'vterm--self-insert)
          (evil-define-key 'insert vterm-mode-map (kbd "C-u")      #'vterm--self-insert)
          (evil-define-key 'insert vterm-mode-map (kbd "C-d")      #'vterm--self-insert)
          (evil-define-key 'insert vterm-mode-map (kbd "C-n")      #'vterm--self-insert)
          (evil-define-key 'insert vterm-mode-map (kbd "C-m")      #'vterm--self-insert)
          (evil-define-key 'insert vterm-mode-map (kbd "C-p")      #'vterm--self-insert)
          (evil-define-key 'insert vterm-mode-map (kbd "C-j")      #'vterm--self-insert)
          (evil-define-key 'insert vterm-mode-map (kbd "C-k")      #'vterm--self-insert)
          (evil-define-key 'insert vterm-mode-map (kbd "C-r")      #'vterm--self-insert)
          (evil-define-key 'insert vterm-mode-map (kbd "C-t")      #'vterm--self-insert)
          (evil-define-key 'insert vterm-mode-map (kbd "C-g")      #'vterm--self-insert)
          (evil-define-key 'insert vterm-mode-map (kbd "C-c")      #'vterm--self-insert)
          (evil-define-key 'insert vterm-mode-map (kbd "C-SPC")    #'vterm--self-insert)
          (evil-define-key 'normal vterm-mode-map (kbd "C-d")      #'vterm--self-insert)
          (evil-define-key 'normal vterm-mode-map (kbd ",c")       #'multi-vterm)
          (evil-define-key 'normal vterm-mode-map (kbd ",n")       #'multi-vterm-next)
          (evil-define-key 'normal vterm-mode-map (kbd ",p")       #'multi-vterm-prev)
          (evil-define-key 'normal vterm-mode-map (kbd "i")        #'evil-insert-resume)
          (evil-define-key 'normal vterm-mode-map (kbd "o")        #'evil-insert-resume)
          (evil-define-key 'normal vterm-mode-map (kbd "<return>") #'evil-insert-resume)
          )
#+end_src

** Better Overview (minimap)

*** Configuration
#+begin_src emacs-lisp
  (use-package! minimap
    :defer t
    :custom (minimap-window-location 'right))
#+end_src
*** Editing Comments

**** Commenter (evil-nerd-commenter)

***** Configuration
#+begin_src emacs-lisp
  (use-package! evil-nerd-commenter)
    ;; :bind ("M-/" . evilnc-comment-or-uncomment-lines))
#+end_src

** Tools

*** Yarn.el

**** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! yarn
      :recipe (:host github
               :repo "jmfirth/yarn.el"))
#+end_src

**** Configuration
#+begin_src emacs-lisp
  (use-package! yarn)
#+end_src

**** COMMENT Hydra Commands
#+begin_src emacs-lisp
  (defhydra rz/yarn-el (:color purple :hint nil :exit t)
    "Yarn Module to Manage Node Plugins"
    ("q" nil "quit"   :exit t)
    ("i" yarn-install :exit t)
    ("n" yarn-init    :exit t)
    ("a" yarn-add     :exit t)
    ("r" yarn-run     :exit t)
    ("p" yarn-publish :exit t)
    ("t" yarn-test    :exit t)
    ("v" yarn-version :exit t)
    ("u" yarn-upgrade :exit t))
#+end_src

*** npm.el

**** Configuration
#+begin_src emacs-lisp
  (use-package! npm
    :commands npm
    :config
    (setq npm-test-library nil)) ;; default is jest
#+end_src

** Highlighting TODO Marks (hl-todo)

*** Configuration
#+begin_src emacs-lisp
  (use-package! hl-todo
    :hook (prog-mode . (lambda () (hl-todo-mode)))
    :config
    (setq hl-todo-keyword-faces
          `(("TODO" . ,(face-foreground 'warning))
            ("PROJ"  . ,(face-foreground 'error))
            ("SOMEDAY"  . ,(face-foreground 'warning))
            ("TODO"  . ,(face-foreground 'warning))
            ("PROG" . ,(face-foreground 'error))
            ("NEXT" . ,(face-foreground 'error))
            ("WAIT" . ,(face-foreground 'warning))
            ("CANCEL" . ,(face-foreground 'error))
            ("DELEGATED" . ,(face-foreground 'error))
            ("IDEA" . ,(face-foreground 'warning))
            ("RDNOTE" . ,(face-foreground 'warning))
            ("GOAL" . ,(face-foreground 'warning))
            ("DUD" . ,(face-foreground 'error))
            ("RD" . ,(face-foreground 'warning))
            ("RDING" . ,(face-foreground 'warning))
            ("TMPDROP" . ,(face-foreground 'warning))
            ("DROP" . ,(face-foreground 'error))
            ("FNSHED" . ,(face-foreground 'success))
            ("DONE"  . ,(face-foreground 'success)))))

 #+end_src

** Cleaning Whitespaces (ws-butler)

*** Configuration
#+begin_src emacs-lisp
  (use-package! ws-butler
    :hook
    (prog-mode . (lambda () (ws-butler-mode)))
    :config
    (ws-butler-global-mode))
#+end_src

** Number Highlighter
***** Configuration
#+begin_src emacs-lisp
  (use-package! highlight-numbers
    :hook
    (prog-mode . (lambda () (    highlight-numbers-mode))))
#+end_src

** Parentheses

*** Beautify (rainbow-delimiters)

**** Configuration
#+begin_src emacs-lisp
  (use-package! rainbow-delimiters
    :hook (prog-mode . (lambda () (rainbow-delimiters-mode))))
#+end_src

*** Smarter Parentheses (smartparens)

**** Configuration
#+begin_src emacs-lisp
  (use-package! smartparens
    :hook ((org-mode prog-mode) . (lambda () (smartparens-mode)))
    :bind
    (:map sp-pair-overlay-keymap
          ("C-g" . evil-normal-state))
    :config
    (sp-local-pair
     '(org-mode)
     "<<" ">>"
     :actions '(insert)))
#+end_src

*** Better Parentheses Control (parinfer-mode)

**** Configuration
#+begin_src emacs-lisp
  (use-package! parinfer-rust-mode
      :hook ( emacs-lisp-mode . (lambda () (parinfer-rust-mode)))
      :init
      (setq parinfer-rust-auto-download t))
#+end_src

**** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! parinfer-rust-mode)
#+end_src

* DevOps

** Ansible

*** COMMENT Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! ansible-doc)
  (package! company-ansible)
#+end_src

*** Configuration
#+begin_src emacs-lisp
  (use-package! ansible
    :commands ansible-auto-decrypt-encrypt
    :init
    (put 'ansible-vault-password-file 'safe-local-variable #'stringp)
    :config
    (setq ansible-section-face 'font-lock-variable-name-face
          ansible-task-label-face 'font-lock-doc-face))
#+end_src

*** Documentation
#+begin_src emacs-lisp
  (use-package! ansible-doc
    :defer t)
#+end_src

*** Company Integration
#+begin_src emacs-lisp
  (use-package! company-ansible
    :after ansible)
#+end_src

** Docker

*** Configuration
#+begin_src emacs-lisp
  (use-package! docker)
    ;; :bind ("C-c d" . docker))
#+end_src

*** Dockerfile
#+begin_src emacs-lisp
  (use-package! dockerfile-mode
    :defer t)
#+end_src

*** Docker-Compose file
#+begin_src emacs-lisp
  (use-package! docker-compose-mode
    :defer t)
#+end_src

*** TRAMP Integration
#+begin_src emacs-lisp
  (use-package! docker-tramp
    :defer t)
#+end_src

** Jenkins

*** Configuration
#+begin_src emacs-lisp
  (use-package! jenkins
    :commands jenkins)
#+end_src

*** Jenkins Watch
#+begin_src emacs-lisp
  (use-package! jenkins-watch
    :after jenkins)
#+end_src

*** Jenkinsfile
#+begin_src emacs-lisp
  (use-package! jenkinsfile-mode
    :defer t)
#+end_src

** Kubernetes

*** Configuration
#+begin_src emacs-lisp
  (use-package! kubernetes
    :commands kubernetes-overview
    :config
    (setq kubernetes-poll-frequency 3600
          kubernetes-redraw-frequency 3600))
#+end_src

*** Evil Integration
#+begin_src emacs-lisp
  (use-package! kubernetes-evil
    :after kubernetes)
#+end_src

** Nginx

*** Files mode
#+begin_src emacs-lisp
  (use-package! nginx-mode
    :defer t
    :config
    (add-to-list 'auto-mode-alist '("/nginx/sites-\\(?:available\\|enabled\\)/" . nginx-mode)))
#+end_src

*** COMMENT Company Integration

**** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! company-nginx)
#+end_src

**** Configuration
#+begin_src emacs-lisp
  (use-package! company-nginx
    :hook (nginx-mode . (lambda () (add-to-list 'company-backends #'company-nginx))))
#+end_src

** Terraform

*** Files
#+begin_src emacs-lisp
  (use-package! terraform-mode
    :defer t
    :hook
    ((terraform-mode .  (lambda () (add-to-list 'company-backends #'company-terraform)))
     (terraform-mode . (lambda () (lsp-deferred)))))
#+end_src

*** COMMENT Company Support
#+begin_src emacs-lisp
  (use-package! company-terraform
    :after terraform-mode
    :config
    (company-terraform-init))
#+end_src

** Editorconfig
#+begin_src emacs-lisp
  (use-package! editorconfig
    :hook (( prog-mode conf-mode ) . editorconfig-mode)
    :config
      (setq editorconfig-trim-whitespaces-mode
        'ws-butler-mode))
    ;; (editorconfig-mode 1))
#+end_src

* Writing

** Touch Typing Trainer (speed-type)

*** Installation
#+begin_src emacs-lisp :tangle packages.el
(package! speed-type)
#+end_src

*** Configuration
#+begin_src emacs-lisp
  (use-package! speed-type
    :commands speed-type-text)
#+end_src

** Word Definition (lexic)
Offline English word dictionary using ~sdcv~ with Stardict Backend, Make sure to download tarball dictionary online to put in ~DIC_FOLDER=$XDG_DATA_HOME/stardict/dic~

*** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! lexic
      :recipe (:host github
               :repo "tecosaur/lexic"))
#+end_src

*** Configuration
#+begin_src emacs-lisp
  (use-package! lexic
    :hook (lexic-mode . (lambda () (visual-line-mode)))
    :commands (lexic-search-word-at-point lexic-search lexic-list-dictionary)
    :bind ("<f12>" . lexic-search-word-at-point))
#+end_src

** Org-Mode

*** Fonts

**** Global Fonts Settings
#+begin_src emacs-lisp
  (defun rz/org-mode-setup ()
    (org-indent-mode)
    ;; (variable-pitch-mode 1)
    (mixed-pitch-mode 1)
    (setq line-spacing 3)
    (visual-line-mode 1)
    (setq evil-auto-indent nil))
#+end_src

**** Change Heading Fonts
#+begin_src emacs-lisp
  (defun rz/org-header-setup ()
    ;; Set faces for heading levels
    (dolist (face '((org-level-1 . 1.2)
                    (org-level-2 . 1.15)
                    (org-level-3 . 1.1)
                    (org-level-4 . 1.075)
                    (org-level-5 . 1.05)
                    (org-level-6 . 1.05)
                    (org-level-7 . 1.05)
                    (org-level-8 . 1.05)))
      (set-face-attribute (car face) nil :font "Fira Sans" :weight 'regular :height (cdr face)))
  ;; Ensure that anything that should be fixed-pitch in Org files appears that way
    (set-face-attribute 'org-document-title nil :font "Bookerly" :weight 'bold :height 200)
    (set-face-attribute 'org-block nil    :foreground nil :inherit 'fixed-pitch)
    (set-face-attribute 'org-table nil    :inherit 'fixed-pitch)
    (set-face-attribute 'org-formula nil  :inherit 'fixed-pitch)
    (set-face-attribute 'org-code nil     :inherit '(shadow fixed-pitch))
    (set-face-attribute 'org-table nil    :inherit '(shadow fixed-pitch))
    (set-face-attribute 'org-verbatim nil :inherit '(shadow fixed-pitch))
    (set-face-attribute 'org-special-keyword nil :inherit '(font-lock-comment-face fixed-pitch))
    (set-face-attribute 'org-meta-line nil :inherit '(font-lock-comment-face fixed-pitch))
    (set-face-attribute 'org-checkbox nil  :inherit 'fixed-pitch)
    (set-face-attribute 'org-headline-done nil  :foreground "#56697A" :strike-through t)
    (set-face-attribute 'line-number nil :inherit 'fixed-pitch)
    (set-face-attribute 'line-number-current-line nil :inherit 'fixed-pitch))
#+end_src

**** Fontify
#+begin_src emacs-lisp
  (after! org
    (setq org-fontify-whole-heading-line t)
    (setq org-fontify-done-headline t)
    (setq org-fontify-quote-and-verse-blocks t))
#+end_src

**** Prettify Symbol
#+begin_src emacs-lisp
  (after! org
    (use-package! org-checklist)
    (setq-default prettify-symbols-alist
                  '(;; Blocks
                   ; Comment
                   ("#+BEGIN_COMMENT" . "ïµ")
                   ("#+END_COMMENT" . "ïµ")
                   ("#+begin_comment" . "ïµ")
                   ("#+end_comment" . "ïµ")
                   ; Center
                   ("#+BEGIN_CENTER" . "ï·")
                   ("#+END_CENTER" . "ï·")
                   ("#+begin_center" . "ï·")
                   ("#+end_center" . "ï·")
                   ; Example
                   ("#+BEGIN_EXAMPLE" . "ï¬")
                   ("#+END_EXAMPLE" . "ï¬")
                   ("#+begin_example" . "ï¬")
                   ("#+end_example" . "ï¬")
                   ; Verse
                   ("#+BEGIN_VERSE" . "ï­")
                   ("#+END_VERSE" . "ï®")
                   ("#+begin_verse" . "ï­")
                   ("#+end_verse" . "ï®")
                   ; Export
                   ("#+BEGIN_EXPORT" . "ï")
                   ("#+END_EXPORT" . "ï")
                   ("#+begin_export" . "ï")
                   ("#+end_export" . "ï")
                   ;; Arrows
                   (">=" . "â¥")
                   ("<=" . "â¤")
                   ("=>" . "â¨")
                   ;; Check Boxes
                   ("[ ]" .  "ï")
                   ("[X]" . "ï" )
                   ("[-]" . "ï" )
                   ;; Properties
                   (":LOGBOOK:" . "â¤")
                   (":PROPERTIES:" . "â")
                   (":END:" . "â")
                   ("DEADLINE:" . "â")
                   ("SCHEDULED:" . "ï³")
                   (":Effort:" . "ï")
                   ;; Header
                   ("#+STARTUP:" . "â¶")
                   ("#+TITLE: " . "")
                   ("#+RESULTS:" . "ï¯")
                   ("#+NAME:" . "ï«")
                   ("#+OPTIONS:" . "ï")
                   ("#+PROPERTY:" . "â")
                   ("#+FILETAGS:" . "ï¬")
                   ("#+HTML_HEAD:" . "ï¼")
                   ("#+SUBTITLE:" . "ï")
                   ("#+AUTHOR:" . "ï")
                   ("#+DATE:" . "ï³")
                   ("#+EMAIL:" . "â")
                   ("#+SETUPFILE:" . "ï")
                   ;; ;; Todos
                   ;; ; Main
                   ;; ("TODO" . "ï")
                   ;; ("NEXT" . "ï")
                   ;; ("PROG" . "ï¡")
                   ;; ("PROJ" . "ï¡")
                   ;; ("WAIT" . "ï")
                   ;; ("CANCEL" . "ï")
                   ;; ("DONE" . "ï")
                   ;; ; Reading
                   ;; ("RD" . "ï")
                   ;; ("RDING" . "ï")
                   ;; ("TMPDROP" . "ï")
                   ;; ("DROP" . "ï")
                   ;; ("FNSHED" . "ï")
                   ))
    (setq prettify-symbols-unprettify-at-point 'right-edge)
    (add-hook 'org-mode-hook 'prettify-symbols-mode))
#+end_src

*** Configuration
#+begin_src emacs-lisp
  (use-package! org
    :hook ((org-mode . (lambda()
                        (rz/org-mode-setup)
                        (rz/org-header-setup))))
    ;;       (org-mode . (lambda()
    ;;                     (add-to-list 'company-backends
    ;;                                 '(company-capf
    ;;                                   company-bbdb
    ;;                                   company-ispell
    ;;                                   company-files
    ;;                                   company-math-symbols-latex
    ;;                                   company-math-symbols-unicode))

    ;;                    (company-mode +1)))
    :config
    (setq org-ellipsis " â¤µ"
          org-startup-indented t
          org-hide-emphasis-markers t
          org-directory org_file_dir
          org-priority-lowest ?D
          org-pretty-entities t))
#+end_src

*** Org-Contrib
#+begin_src emacs-lisp :tangle packages.el
  (package! org-contrib)
#+end_src
*** UI Expansion
**** Update Last Modified
Handling file properties for âLAST_MODIFIEDâ
#+begin_src emacs-lisp
    (defun rz/org-find-time-file-property (property &optional anywhere)
      "Return the position of the time file PROPERTY if it exists.
       When ANYWHERE is non-nil, search beyond the preamble."
      (save-excursion
        (goto-char (point-min))
        (let ((first-heading
               (save-excursion
                 (re-search-forward org-outline-regexp-bol nil t))))
          (when (re-search-forward (format "^#\\+%s:" property)
                                   (if anywhere nil first-heading)
                                   t)
            (point)))))

    (defun rz/org-has-time-file-property-p (property &optional anywhere)
      "Return the position of time file PROPERTY if it is defined.

  As a special case, return -1 if the time file PROPERTY exists but
  is not defined."
      (when-let ((pos (rz/org-find-time-file-property property anywhere)))
        (save-excursion
          (goto-char pos)
          (if (and (looking-at-p " ")
                   (progn (forward-char)
                          (org-at-timestamp-p 'lax)))
              pos
            -1))))

    (defun rz/org-set-time-file-property (property &optional anywhere pos)
      "Set the time file PROPERTY in the preamble.
  When ANYWHERE is non-nil, search beyond the preamble.
  If the position of the file PROPERTY has already been computed,
  it can be passed in POS."
      (when-let ((pos (or pos
                          (rz/org-find-time-file-property property))))
        (save-excursion
          (goto-char pos)
          (if (looking-at-p " ")
              (forward-char)
            (insert " "))
          (delete-region (point) (line-end-position))
          (let* ((now (format-time-string "[%Y-%m-%d %a %H:%M]")))
            (insert now)))))

    (defun rz/org-set-last-modified ()
      "Update the LAST_MODIFIED file property in the preamble."
      (when (derived-mode-p 'org-mode)
        (rz/org-set-time-file-property "LAST_MODIFIED")))
#+end_src

**** Better Hide Emphasis Markers
***** Installation
#+begin_src emacs-lisp :tangle packages.el
(package! org-appear)
#+end_src

***** Configuration
#+begin_src emacs-lisp
  (use-package! org-appear
    :hook (org-mode . org-appear-mode)
    :config
    (setq org-appear-autoemphasis t
          org-appear-autosubmarkers t
          org-appear-autolinks nil)
    ;; for proper first-time setup, `org-appear--set-elements'
    ;; needs to be run after other hooks have acted.
    (run-at-time nil nil #'org-appear--set-elements))
#+end_src

**** COMMENT Better Table
***** Installation
#+begin_src emacs-lisp :tangle packages.el
(package! org-pretty-table :recipe (:host github :repo "Fuco1/org-pretty-table"))
#+end_src

***** Configuration
#+begin_src emacs-lisp
  (use-package! org-pretty-table
    :hook (org-mode . (lambda() (org-pretty-table-mode))))
#+end_src

**** COMMENT Superstar
#+begin_src emacs-lisp
  (use-package! org-superstar
    :hook (org-mode . (lambda () (org-superstar-mode)))
    :config
    (setq org-superstar-special-todo-items t
          org-superstar-todo-bullet-alist
          '(("TODO" . 61708)
            ("NEXT" . 61469)
            ("PROG" . 61729)
            ("PROJ" . 61729)
            ("WAIT" . 62092)
            ("CANCEL" . 61532)
            ("DONE" . 61533)
            ("RD" . 61708)
            ("RDING" . 61469)
            ("TMPDROP" . 62092)
            ("DROP" . 61532)
            ("FNSHED" . 61533))))
#+end_src

**** COMMENT Contents Outline Map
I decided to disable this for now as the package seems no longer maintained and ~treemacs v3~ update broke it.

***** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! org-ol-tree :recipe (:host github :repo "Townk/org-ol-tree"))
#+end_src

***** Configuration
#+begin_src emacs-lisp
  (use-package! org-ol-tree
    :commands org-ol-tree)
#+end_src

*** Miscellaneous Configurations
**** Extra Exporting Support
#+begin_src emacs-lisp
  (after! org
    (require 'ox-extra)
    (ox-extras-activate '(latex-header-blocks ignore-headlines)))
#+end_src

**** Babel

***** Add support to edit linux config files
#+begin_src emacs-lisp
  (after! org
  (org-babel-do-load-languages
    'org-babel-load-languages
    '((emacs-lisp . t)
      (python     . t)
      (shell      . t)
      (js         . t)
      (perl       . t)
      (clojure    . t)
      (ruby       . t)
      (dot        . t)
      (css        . t)
      (plantuml   . t)))
  (add-to-list 'org-src-lang-modes '("dot" . "graphviz-dot"))

  (push '("conf-unix" . conf-unix) org-src-lang-modes))
#+end_src

***** Asynchronous Executions (ob-async)
By adding ~:async~ into the options of org block.
#+begin_src emacs-lisp
  (use-package! ob-async
    :after org)
#+end_src

***** Fake Languages

****** Inline-Javascript
This snippet is taken from [[https://www.reddit.com/r/orgmode/duplicates/5bi6ku/tip_for_exporting_javascript_source_block_to/][Tip for exporting JavaScript source block to `<script>` tags in HTML export - Reddit]].
#+begin_src emacs-lisp
  (after! org
    (add-to-list 'org-src-lang-modes '("inline-js" . javascript))
    (defvar org-babel-default-header-args:inline-js
      '((:results . "html")
        (:exports . "results")))
    (defun org-babel-execute:inline-js (body _params)
      (format "<script type=\"text/javascript\">\n%s\n</script>" body)))
#+end_src

****** LaTeX Macros
This snippet is taken from [[https://www.reddit.com/r/orgmode/comments/7u2n0h/tip_for_defining_latex_macros_for_use_in_both/][Tip for defining LaTeX macros for use in both LaTeX and HTML/MathJax export - Reddit]].
#+begin_src emacs-lisp
  (after! org
   (add-to-list 'org-src-lang-modes '("latex-macros" . latex))

   (defvar org-babel-default-header-args:latex-macros
     '((:results . "raw")
       (:exports . "results")))

   (defun prefix-all-lines (pre body)
     (with-temp-buffer
       (insert body)
       (string-insert-rectangle (point-min) (point-max) pre)
       (buffer-string)))

   (defun org-babel-execute:latex-macros (body _params)
     (concat
      (prefix-all-lines "#+LATEX_HEADER: " body)
      "\n#+HTML_HEAD_EXTRA: <div style=\"display: none\"> \\(\n"
      (prefix-all-lines "#+HTML_HEAD_EXTRA: " body)
      "\n#+HTML_HEAD_EXTRA: \\)</div>\n")))
#+end_src

**** Structure templates
#+begin_src emacs-lisp
(after! org
  ;; this is needed as of org 9.2
  (require 'org-tempo)

  (add-to-list 'org-structure-template-alist '("sh" . "src shell"))
  (add-to-list 'org-structure-template-alist '("el" . "src emacs-lisp"))
  (add-to-list 'org-structure-template-alist '("py" . "src python")))
#+end_src

*** Packages

**** LaTeX Document Comparison (orgdiff)
This setting is taken from [[https://tecosaur.github.io/emacs-config/config.html#language-configuration][Tecousaur's Config]]
***** Installation
#+begin_src emacs-lisp :tangle packages.el
(package! org-diff :recipe (:host github :repo "tecosaur/orgdiff"))
#+end_src

***** Configuration
#+begin_src emacs-lisp
  (use-package! orgdiff
    :defer t
    :config
    (defun rz/orgdiff-nicer-change-colours ()
      (goto-char (point-min))
      ;; Set red/blue based on whether chameleon is being used
      (if (search-forward "%% make document follow Emacs theme" nil t)
          (setq red  (substring (doom-blend 'red 'fg 0.8) 1)
                blue (substring (doom-blend 'blue 'teal 0.6) 1))
        (setq red  "c82829"
              blue "00618a"))
      (when (and (search-forward "%DIF PREAMBLE EXTENSION ADDED BY LATEXDIFF" nil t)
                 (search-forward "\\RequirePackage{color}" nil t))
        (when (re-search-forward "definecolor{red}{rgb}{1,0,0}" (cdr (bounds-of-thing-at-point 'line)) t)
          (replace-match (format "definecolor{red}{HTML}{%s}" red)))
        (when (re-search-forward "definecolor{blue}{rgb}{0,0,1}" (cdr (bounds-of-thing-at-point 'line)) t)
          (replace-match (format "definecolor{blue}{HTML}{%s}" blue)))))
    (add-to-list 'orgdiff-latexdiff-postprocess-hooks #'+orgdiff-nicer-change-colours))
#+end_src

*** Agenda
My approach with org-agenda is by splitting each setting to each different snippets, for modularity and ease of maintenance

**** Agenda files directory
Since org-agenda is a part of org-mode functionality I use =with-eval-after-load= command to set up most of my agenda configuration
#+begin_src emacs-lisp
  (after! org-agenda
    (setq org-agenda-files (list
                            (concat org_agenda "projects.org")
                            (concat org_agenda "daily_habits.org")
                            (concat org_agenda "weekly_habits.org")
                            (concat org_agenda "monthly_habits.org")
                            ;; (concat org_file_dir "quarterly_habits.org")
                            ;; (concat org_file_dir "personal.org")
                            (concat org_agenda "inbox.org")
                            (concat org_agenda "next.org")
                            (concat org_agenda "waiting.org")
                            (concat org_agenda "future.org")
                            (concat org_agenda "this_month.org")
                            (concat org_agenda "mail.org")
                            (concat org_agenda "pe.org")
                            (concat org_agenda "birthdays/")
                            (concat org_agenda "reading_list.org")
                            ;; org_file_dir
                            ;; work-path
                            ;; (concat org_file_dir "projects/2021/")
                            ;; (concat org_file_dir "journal/")
                            )))
#+end_src

**** Time-Grid Settings
#+begin_src emacs-lisp
    (after! org-agenda
      (setq org-agenda-time-grid
            (quote
             ((daily today require-timed) ()
              "......" "----------------"))))
#+end_src

**** Task logging
#+begin_src emacs-lisp
  (after! org-agenda
    (setq org-agenda-start-with-log-mode t)
    (setq org-log-done 'time)
    (setq org-log-into-drawer t))
#+end_src

**** Keywords for TODOs
#+begin_src emacs-lisp
  (after! org-agenda
    (use-package! org-depend)
    (use-package! org-choose)
    (use-package! org-effectiveness)
    (setq org-todo-keywords '((sequence
                               "TODO"
                               "PROJ"
                               "NEXT(n)"
                               "PROG(p!)"
                               "WAIT(w@/!)"
                               "SOMEDAY"
                               "|"
                               "DONE(d)"
                               "CANCEL(c@)"
                               "DELEGATED(@)")

                              (sequence
                               "IDEA"
                               "RDNOTE"
                               "GOAL"
                               "|"
                               "DUD(@)")
                              (sequence
                               "RD"
                               "RDING"
                               "TMPDROP"
                               "|"
                               "DROP"
                               "FNSHED"))))

#+end_src

**** Keybinding
Adding ~j~ and ~k~ to move up and down
#+begin_src emacs-lisp
  (after! org-agenda
    (define-key org-agenda-keymap (kbd "j") 'org-agenda-next-line)
    (define-key org-agenda-keymap (kbd "k") 'org-agenda-previous-line)
    (define-key org-agenda-mode-map (kbd "j") 'org-agenda-next-line)
    (define-key org-agenda-mode-map (kbd "k") 'org-agenda-previous-line))

  (after! org-super-agenda
    (define-key org-super-agenda-header-map (kbd "j") 'org-agenda-next-line)
    (define-key org-super-agenda-header-map (kbd "k") 'org-agenda-previous-line))
#+end_src
**** Agenda views

***** Super-Agenda

****** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! org-super-agenda)
#+end_src

****** Configuration
#+begin_src emacs-lisp
  (use-package! org-super-agenda
    :after org-agenda
    :config
    (setq org-agenda-skip-deadline-if-done t
          org-agenda-skip-scheduled-if-done t
          org-agenda-include-deadlines t)
    (org-super-agenda-mode))
#+end_src

****** Agenda View
#+begin_src emacs-lisp
  (after! org-super-agenda
  (setq org-agenda-custom-commands '(("d" "Dashboard"
                                       ((agenda "" ((org-agenda-span 'day)
                                                    (org-agenda-start-day "+0d")
                                                    (org-agenda-overriding-header "")
                                                    (org-super-agenda-groups
                                                     '((:name "Important" :priority "A" :order 1)
                                                       (:name "Email" :tag "email" :order 2)
                                                       (:name "Today"
                                                        :discard (:tag "email")
                                                        :time-grid t
                                                        :date today
                                                        :scheduled today
                                                        :deadline today
                                                        :todo "TODAY")
                                                       (:name "Work" :tag "@work" :order 2)
                                                       (:name "School" :tag "@school" :order 2)
                                                       (:name "Hobby" :tag "hobby" :order 2)
                                                       (:todo "PROG")
                                                       (:name "My Goals" :todo "GOAL" :order 1)
                                                       (:name "Next Actions" :todo "NEXT" :order 1)
                                                       (:name "Waiting For" :todo "WAIT" :order 1)
                                                       (:name "Your Projects":todo "PROJ" :order 1)
                                                       (:name "Quick Picks" :effort< "0:20" :order 2)
                                                       (:name "Tasks" :discard(:habit) :todo "TODO" :order 1)
                                                       (:name "My Goals" :todo "GOAL" :order 1)
                                                       (:name "Books You Are Reading"
                                                               :todo "RDING" :order 2)
                                                       (:priority<= "B" :order 99)
                                                       (:discard (:todo ("IDEA" "SOMEDAY" "TMPDROP" "RD") :habit))
                                                       ))))))
                                     ("j" "Overview"
                                       ((alltodo "" ((org-agenda-span 'day)
                                                    (org-agenda-overriding-header "Overview")
                                                    (org-super-agenda-groups
                                                     '((:name "Important" :priority "A" :order 1)
                                                       (:name "Email" :tag "email" :order 2)
                                                       (:name "Work" :tag "@work" :order 2)
                                                       (:name "School" :tag "@school" :order 2)
                                                       (:name "Hobby" :tag "hobby" :order 2)
                                                       (:todo "PROG")
                                                       (:name "My Goals" :todo "GOAL" :order 1)
                                                       (:name "Next Actions" :todo "NEXT" :order 1)
                                                       (:name "Waiting For" :todo "WAIT" :order 1)
                                                       (:name "Your Projects":todo "PROJ" :order 1)
                                                       (:name "Quick Picks" :effort< "0:20" :order 2)
                                                       (:name "Tasks" :discard(:habit) :todo "TODO" :order 1)
                                                       (:name "My Goals" :todo "GOAL" :order 1)
                                                       (:name "Books You Are Reading"
                                                               :todo "RDING" :order 2)
                                                       (:priority<= "B" :order 99)
                                                       (:discard (:todo ("IDEA" "SOMEDAY" "TMPDROP" "RD") :habit))
                                                        ))))))
                                     ("k" "Kanban"
                                      ((alltodo "" ((org-agenda-overriding-header "Kanban Board")
                                                    (org-super-agenda-groups
                                                      '((:name "Backlog" :tag "backlog" :order 1)
                                                        (:name "Planning" :tag "plan" :order 1)
                                                        (:name "In Progress" :tag "active" :order 1)
                                                        (:name "Testing" :tag "testing" :order 1)
                                                        (:name "Completed" :tag "active" :order 1)
                                                        (:name "Canceled" :tag "Canceled" :order 1)
                                                        (:discard (:anything t))
                                                       ))))))
                                      ("b" "Books"
                                       ((alltodo "" ((org-agenda-overriding-header "Books that Garner Your Insterests")
                                                    (org-super-agenda-groups
                                                     '((:name "Books You Are Reading"
                                                              :todo "RDING")
                                                       (:name "Books To Read"
                                                              :todo "RD")
                                                       (:name "Books You Left Temporarily"
                                                              :todo "TMPDROP")
                                                       (:discard (:anything t)))))))))))
#+end_src

**** Dim Blocked Tasks
#+begin_src emacs-lisp
  (after! org-agenda
    (setq org-agenda-dim-blocked-tasks 'invisible))
#+end_src

**** Tags
#+begin_src emacs-lisp
  (after! org
    (use-package! org-interactive-query)

    (setq org-tag-alist
          '(; Environmental Context
            (:startgroup)
            ("@home" . ?H)
            ("@work" . ?W)
            ("@college" . ?C)
            ("@everywhere" . ?E)
            (:endgroup)
            ; Workflow Context
            (:startgroup)
            ("@smartphone" . ?s)
            ("@laptop" . ?l)
            (:endgroup)
            ;Agenda Context
            (:startgroup)
            ("@errand" . ?e)
            ("@job" . ?o)
            ("@favor" . ?f)
            (:endgroup)
            ;Kanban
            (:startgroup)
            ("review" . ?w)
            ("plan" . ?p)
            ("active" . ?v)
            ("backlog" . ?b)
            ("testing" . ?r)
            (:startgroup)
            ("completed" . ?d)
            ("canceled" . ?c)
            (:endgroup)
            (:endgroup)
            ("publish" . ?P)
            ("batch" . ?b)
            ("thesis" . ?t)
            ("agenda" . ?a)
            ("project" . ?j)
            ("email" . ?m)
            ("note" . ?n)
            ("idea" . ?i))))
#+end_src

**** Refile
#+begin_src emacs-lisp
  (after! org
    (setq org-refile-targets
          '(("../archive/Archive.org" :maxlevel . 1)
            ("../archive/Read.org" :maxlevel . 1)
            ("future.org" :maxlevel . 1)
            ("projects.org" :maxlevel . 1)
            ("this_month.org" :maxlevel . 1)
            ("inbox.org" :maxlevel . 1)
            ("waiting.org" :maxlevel . 1)
            ("next.org" :maxlevel . 1)))
    ;; Save Org buffers after refiling!
    (advice-add 'org-refile :after 'org-save-all-org-buffers))
#+end_src

**** Capture

***** Templates
#+begin_src emacs-lisp
(load-file (expand-file-name "elisp/org-capture-templates.el" doom-private-dir))
#+end_src

I need this to be in separate file as I share this with the dedicated capture daemon
#+begin_src emacs-lisp :tangle elisp/org-capture-templates.el
(with-eval-after-load 'org
 (setq org-capture-templates
     ;; Tasks
   `(("t" "Tasks / Projects")
     ("tt" "Today" entry (file+olp ,(concat org_agenda_dir "next.org") "Today's Tasks")
      "* NEXT %?\nSCHEDULED:%^T  %U\n  %a\n  %i" :empty-lines 1)
     ("td" "Today Deadline" entry (file+olp ,(concat org_agenda_dir "next.org") "Today's Tasks")
      "* TODO %? \nDEADLINE: %^T\n %U" :empty-lines 1)
     ("ts" "Inbox Scheduled" entry (file+olp ,(concat org_agenda_dir "inbox.org") "Tasks")
      "* TODO %?\nSCHEDULED:%^T  %U\n  %a\n  %i" :empty-lines 1)
     ("tD" "Inbox Deadline" entry (file+olp ,(concat org_agenda_dir "inbox.org") "Tasks")
      "* TODO %? \nDEADLINE: %^T\n %U" :empty-lines 1)
     ("tw" "Wait deadline" entry (file+olp ,(concat org_agenda_dir "waiting.org") "Waiting For")
      "* WAIT %? From _%^{Delegated To}_ \nDEADLINE: %^T\n %U\n %a" :empty-lines 1)

     ;; Catchall for faster capture "SPC-x-x"
     ("x" "Inbox" entry (file+olp ,(concat org_agenda_dir "inbox.org") "Everything/Notes")
      "* %? \n %U\n %a" :empty-lines 1)

     ;; Events
     ("e" "Event" entry (file ,(concat org_agenda_dir "gcal/events.org"))
      "* %?\n %U":empty-lines 1)

     ;; Reading Lists
     ("r" "Reading List")
     ("ra" "Article" entry
      (file+olp ,(concat org_agenda_dir "reading_list.org") "Journal Article")
      "* RD %? \n%U\n%a" :empty-lines 1)
     ("rb" "Books" entry
      (file+olp ,(concat org_agenda_dir "reading_list.org") "Books")
      "* RD %? \n%U\n%a" :empty-lines 1)

     ;; Birthdays
     ("b" "Birthdays")
     ("br" "Relatives/Family" entry
      (file+olp ,(concat org_agenda_dir "birthdays.org") "Relatives")
      "* %^{Who?} \n%^{Birthday}t\n%U" :empty-lines 1 :immediate-finish 1)
     ("ba" "Acquintances" entry
      (file+olp ,(concat org_agenda_dir "birthdays.org") "Acquintances")
      "* %^{Who?} \n%^{Birthday}t\n%U" :empty-lines 1 :immediate-finish 1)
     ("bf" "Friends" entry
      (file+olp ,(concat org_agenda_dir "birthdays.org") "Friends")
      "* %^{Who?} \n%^{Birthday}t\n%U" :empty-lines 1 :immediate-finish 1)
     ("bo" "Others" entry
      (file+olp ,(concat org_agenda_dir "birthdays.org") "Others")
      "* %^{Who?} \n%^{Birthday}t\n%U" :empty-lines 1 :immediate-finish 1)

     ;; workflow
     ("m" "Meeting" entry
      (file+olp+datetree ,(concat org_file_dir "meetings.org") "Active")
      "* %<%I:%M %p> - %a :meetings:\n\n%?\n\n"
      :clock-in :clock-resume :empty-lines 1)
     ("E" "Emails")
     ("Er" "Read Later" entry
      (file+olp ,(concat org_agenda_dir "mail.org") "Read Later")
      (file ,(concat doom-private-dir "orgtemplates/mailreadlater.org"))
      :empty-lines 1 :immediate-finish t)
     ("Ef" "Follow Up" entry (file+olp ,(concat org_agenda_dir "mail.org") "Follow Up")
      (file ,(concat doom-private-dir "orgtemplates/mailfollowup.org"))
      :empty-lines 1 :immediate-finish t)
     ("Es" "Send Mail" entry
      (file+olp ,(concat org_agenda_dir "mail.org") "Compose Mail")
      (file ,(concat doom-private-dir "orgtemplates/mailsendmail.org"))
      :empty-lines 1 :immediate-finish t)

     ;; Tracking
     ("M" "Metrics Capture")
     ("Mw" "Weight" table-line
      (file+headline ,(concat org_file_dir "weight.org") "Weight")
      "| %U | %^{Weight} | %^{Notes} |" :immediate-finish t)
     ("Mp" "PE" table-line
      (file+headline ,(concat org_agenda_dir "pe.org") "Measurements")
      "| %U | %^{BPEL} | %^{EG} | %^{NBPEL} | %^{BPFSL} |"
      :immediate-finish t)
     ("Ml" "Lead Managements" table-line
      (file+headline "~/Videos/Intergender Dynamic/Occam's Razor - Ultimate Seduction System/Template For Managing Leads/Template for Managing Leads.org" "Leads")
      "| %U | %^{Girl Name} | %^{Date Time}T | %^{Had Sex?} | %^{Repeat?} | %^{Source (Daygame, Nightgame, Onlinegame, Else)} | %^{Description} | %^{Next Actions} |"
      :immediate-finish t)

     ;; Journal
     ("j" "Journal Entries")
     ("jj" "Journal Entry" entry
      (function rz/org-journal-find-location)
      "\n** %<%I:%M %p> - %? :journal:\n" :empty-lines 1)
     ("js" "Scheduled Journal" entry
      (function rz/org-journal-date-location)
      "* TODO %?\n <%(princ org-journal--date-location-scheduled-time)>\n"
      :empty-lines 1)
     ("jm" "Morning Journal entry" entry
      (function rz/org-journal-find-location)
      (file ,(concat doom-private-dir "orgtemplates/morningroutine.org"))
      :empty-lines 1 :jump-to-captured t)
     ("jn" "Night Journal entry" entry
      (function rz/org-journal-find-location)
      (file ,(concat doom-private-dir "orgtemplates/nightroutine.org"))
      :empty-lines 1 :jump-to-captured t)
     ("jw" "Weekly Review" entry
      (file ,(concat org_journal_weekly_dir "2022.org"))
      (file ,(concat doom-private-dir "orgtemplates/weeklyreview.org"))
      :empty-lines 1 :jump-to-captured t)

     ;; Cookbook
     ("c" "Cookbook")
     ("cc" "Web Fetch" entry (file "~/org/cookbook.org")
      "%(org-chef-get-recipe-from-url)"
      :empty-lines 1)
     ("cm" "Manual Cookbook" entry (file ,(concat org_file_dir "cookbook.org"))
      "* %^{Recipe title: }\n:PROPERTIES:\n  :source-url:\n  :servings:\n  :prep-time:\n  :cook-time:\n  :ready-in:\n  :END:\n** Ingredients\n   %?\n** Directions\n\n")

     ;; Protocol
     ("Q" "[pro] Web Quote" entry (file+olp ,(concat org_agenda_dir "inbox.org") "Web Quote")
      "* %^{Quote from/Who said this}\n:PROPERTIES:\n:SOURCE: %:annotation\n:CREATED_AT: %U\n:END:\n#+BEGIN_QUOTE\n%i\n#+END_QUOTE\n%^{What do you think about this quote}"
      :prepend t :empty-lines 1
      :immediate-finish t)
     ("L" "[pro] Web Link" entry (file+olp ,(concat org_agenda_dir "reading_list.org") "Web")
      "* RD [[%:link][%:description]]\n%U\n%^{What is the gist of it} "
      :prepend t :empty-lines 1
      :immediate-finish t)
     ("W" "[pro] Web Reading List" entry
      (file+olp ,(concat org_agenda_dir "reading_list.org") "Web")
      "* RD %? \n%U\n%a" :empty-lines 1))))
#+end_src

***** Org Protocol Capture Setup
Setup these bookmarklet on your Browser
#+begin_src javascript :tangle no
// Web Quote: I name this Bookmarklet as "Org: Save Quote"
javascript:location.href='org-protocol://capture://Q/'+
      encodeURIComponent(location.href)+'/'+
      encodeURIComponent(document.title)+'/'+
      encodeURIComponent(window.getSelection())

// Web Link: I name this Bookmarklet as "Org: Read Later"
javascript:location.href='org-protocol://capture://R/'+
      encodeURIComponent(location.href)+'/'+
      encodeURIComponent(document.title)+'/'

// For copying webpage link to emacs, saved as "Org: Copy Page Link"
javascript:location.href='org-protocol://store-link://'+
      encodeURIComponent(location.href)
#+end_src

Make sure to set up ~org-protocol.desktop~ file in your ~~/.local/share/applications~ or ~/etc/share/applications~ with this input
#+begin_src conf :tangle no
[Desktop Entry]
Name=Org-Protocol
Exec=emacsclient %u
Type=Application
Icon=emacs
Terminal=false
Categories=System;
MimeType=x-scheme-handler/org-protocol;
#+end_src

***** Customization for =org-capture bin=
#+begin_src emacs-lisp
(setf (alist-get 'height +org-capture-frame-parameters) 15)
;; (alist-get 'name +org-capture-frame-parameters) "â Capture") ;; ATM hardcoded in other places, so changing breaks stuff
(setq +org-capture-fn
      (lambda ()
        (interactive)
        (set-window-parameter nil 'mode-line-format 'none)
        (org-capture)))
#+end_src
***** Org Capture Frame
#+begin_src emacs-lisp
(defun rz/delete-capture-frame (&rest _)
  "Delete frame with its name frame-parameter set to \"ï Capture\"."
  (if (equal "ï Capture" (frame-parameter nil 'name))
      (delete-frame)))

(with-eval-after-load 'org
 (advice-add 'org-capture-finalize :after #'rz/delete-capture-frame))

(defun rz/org-capture-frame ()
  "Run org-capture in its own frame."
  (interactive)
  (use-package! cl-lib)
  (select-frame-by-name "ï Capture")
  (delete-other-windows)
  (cl-letf (((symbol-function 'switch-to-buffer-other-window) #'switch-to-buffer))
    (condition-case err
        (org-capture)
      ;; "q" signals (error "Abort") in `org-capture'
      ;; delete the newly created frame in this scenario.
      (user-error (when (string= (cadr err) "Abort")
                    (delete-frame))))))
#+end_src

**** Habit-plus

***** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! org-habit-plus :recipe
      (:host github :repo "myshevchuk/org-habit-plus"
       :files ("org-habit-plus.el")))
#+end_src

***** Configuration
Using org-habit-plus
#+begin_src emacs-lisp
  (use-package! org-habit-plus
    :after org-agenda
    :init
    (add-to-list 'org-modules 'org-habit-plus)
    :custom
    (setq org-habit-graph-column 60
          org-habit-show-habits-only-for-today t))
#+end_src

**** Better Calendar View (calfw)

***** Configuration
#+begin_src emacs-lisp
  (use-package! calfw
    :after org-agenda)
#+end_src

***** Org-Integration

****** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! calfw-org)
#+end_src

****** Configuration
#+begin_src emacs-lisp
  (use-package! calfw-org
    :after calfw)
#+end_src

***** Custom Calendar
#+begin_src emacs-lisp
  (defun my-open-calendar ()
    (interactive)
    (cfw:open-calendar-buffer
     :contents-sources
     (list
      (cfw:org-create-source "Green")  ; org-agenda source
      ;; (cfw:org-create-file-source "cal" "/path/to/cal.org" "Cyan")  ; other org source
      ;; (cfw:howm-create-source "Blue")  ; howm source
      ;; (cfw:cal-create-source "Orange") ; diary source
      ;; (cfw:ical-create-source "Moon" "~/moon.ics" "Gray")  ; ICS source1
      ;; (cfw:ical-create-source "gcal" "https://..../basic.ics" "IndianRed") ; google calendar ICS
     )))
#+end_src

*** Scimax-LaTeX

**** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! scimax-latex :recipe
      (:host github
       :repo "jkitchin/scimax"
       :files ("scimax-latex.el")))
#+end_src

**** Configuration
#+begin_src emacs-lisp
  (use-package! scimax-latex
    :defer t
    :commands (scimax-latex-setup
               kpsewhich
               texdoc))
#+end_src

*** CDLaTeX

**** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! cdlatex)
#+end_src

**** Configuration
#+begin_src emacs-lisp
  (use-package! cdlatex
    :config
    (add-hook 'org-mode-hook #'turn-on-org-cdlatex))
#+end_src

*** Fragtog
Instantly toggle inline latex
#+begin_src emacs-lisp
  (use-package! org-fragtog
    :commands org-fragtog-mode)
#+end_src

*** Ref

**** Configuration
#+begin_src emacs-lisp
  (use-package! citeproc)

  (use-package! org-ref
      :config
      (setq
           org-ref-completion-library 'org-ref-ivy-cite
           org-ref-get-pdf-filename-function 'org-ref-get-pdf-filename-helm-bibtex
           reftex-default-bibliography '("~/Documents/Reza/BibTex/Zotero-mylib/Zotero-mylib.bib" "~/Documents/Reza/BibTex/Zotero-mylib/CalibreBib.bib")
           org-ref-note-title-format "* TODO %y - %t\n :PROPERTIES:\n  :Custom_ID: %k\n  :NOTER_DOCUMENT: %F\n :ROAM_KEY: cite:%k\n  :AUTHOR: %9a\n  :JOURNAL: %j\n  :YEAR: %y\n  :VOLUME: %v\n  :PAGES: %p\n  :DOI: %D\n  :URL: %U\n :END:\n\n"
           org-ref-notes-directory org_noter
           org-ref-notes-function 'orb-edit-notes))
#+end_src

**** Keybinding for helm-bibtex
#+begin_src emacs-lisp
  (global-set-key (kbd "<f6>") #'org-ref-helm-insert-cite-link)
#+end_src

**** Bibliography Notes Location (org-roam integration)
#+begin_src emacs-lisp
  (setq bibtex-completion-pdf-open-function
        (lambda (fpath)
          (call-process "foliate" nil 0 nil fpath))
        bibtex-completion-notes-path bib_notes
        bibtex-completion-bibliography
        '("~/Documents/Reza/BibTex/Zotero-mylib/Zotero-mylib.bib"
          "~/Documents/Reza/BibTex/Zotero-mylib/CalibreBib.bib")
        bibtex-completion-library-path zot_col
        bibtex-completion-pdf-field "file")
#+end_src

*** Roam

**** Configuration
#+begin_src emacs-lisp
  ;; Based on SM-5
  (use-package! org-learn)

  (use-package! org-roam
    :after org
    :preface
    (defvar org-roam-directory (expand-file-name org_roam))
    :init
    (setq org-roam-v2-ack t)
    :commands
    (org-roam-buffer
     org-roam-setup
     org-roam-capture
     org-roam-node-find)
    :config
    (setq org-roam-mode-section-functions
          '(org-roam-backlinks-section
            org-roam-reflinks-section
            org-roam-unlinked-references-section)) ;; disable this because it still quite slow
    (require 'find-lisp)
    (setq org-id-extra-files (find-lisp-find-files org-roam-directory "\.org$"))
    (evil-define-key 'insert org-roam-mode-map
      (kbd "C-<tab>") 'company-capf)
    (define-key org-roam-mode-map
      [mouse-1] #'org-roam-visit-thing)
    (org-roam-setup))
#+end_src

***** Hide Properties
This is executed in ~hydra/roam~ through ~SPC-n-r-p~
#+begin_src emacs-lisp
  (after! org
    (use-package! org-collector)

    (defun org-hide-properties ()
     "Hide all org-mode headline property drawers in buffer. Could be slow if buffer has a lot of overlays."
     (interactive)
     (save-excursion
       (goto-char (point-min))
       (while (re-search-forward
               "^ *:properties:\n\\( *:.+?:.*\n\\)+ *:end:\n" nil t)
         (let ((ov_this (make-overlay (match-beginning 0) (match-end 0))))
           (overlay-put ov_this 'display "")
           (overlay-put ov_this 'hidden-prop-drawer t)))))

   (defun org-show-properties ()
     "Show all org-mode property drawers hidden by org-hide-properties."
     (interactive)
     (remove-overlays (point-min) (point-max) 'hidden-prop-drawer t))

   (defun org-toggle-properties ()
     "Toggle visibility of property drawers."
     (interactive)
     (if (eq (get 'org-toggle-properties-hide-state 'state) 'hidden)
         (progn
           (org-show-properties)
           (put 'org-toggle-properties-hide-state 'state 'shown))
       (progn
         (org-hide-properties)
         (put 'org-toggle-properties-hide-state 'state 'hidden))))

  ;; Set hide properties as default behaviour
   (add-hook 'org-mode-hook #'org-hide-properties))
#+end_src

***** COMMENT Better =org-roam-node-find=
#+begin_src emacs-lisp
  (cl-defmethod org-roam-node-directories ((node org-roam-node))
    (if-let ((dirs (file-name-directory (file-relative-name (org-roam-node-file node) org-roam-directory))))
        (format "(%s)" (car (f-split dirs)))
      ""))

  (cl-defmethod org-roam-node-backlinkscount ((node org-roam-node))
    (let* ((count (caar (org-roam-db-query
                         [:select (funcall count source)
                                  :from links
                                  :where (= dest $s1)
                                  :and (= type "id")]
                         (org-roam-node-id node)))))
      (format "[%d]" count)))

  (cl-defmethod org-roam-node-filetitle ((node org-roam-node))
    "Return the file TITLE for the node."
    (org-roam-get-keyword "TITLE" (org-roam-node-file node)))

  (cl-defmethod org-roam-node-hierarchy ((node org-roam-node))
    "Return the hierarchy for the node."
    (let ((title (org-roam-node-title node))
          (olp (org-roam-node-olp node))
          (level (org-roam-node-level node))
          (filetitle (org-roam-node-filetitle node)))
      (concat
       (if (> level 0) (concat filetitle " > "))
       (if (> level 1) (concat (string-join olp " > ") " > "))
       title)))

  (setq org-roam-node-display-template "${directories:10} ${tags:20} ${title:100} ${backlinkscount:6}")
  ;; (setq org-roam-node-display-template "${hierarchy:*} ${tags:20} ${backlinkscount:6}")
#+end_src

**** Capture Template

***** Normal Roam Files
#+begin_src emacs-lisp
  (after! org-roam
    (setq orb-file-field-extensions '("pdf" "epub" "djvu" "mobi" "azw3"))
    (setq orb-preformat-keywords
          '(("citekey" . "=key=") "title" "cover" "url" "tags" "date" "abstract" "year" "journal" "note" "volume" "pages" "doi" "isbn" "issn" "publisher" "file" "author-or-editor" "keywords"))
    (setq org-roam-capture-templates
            '(("d" "default" plain
               (file "~/.config/chemacs/dotemacsen/Reza/orgtemplates/roamDefault.org")
               :if-new
               (file+head "%<%Y%m%d%H%M%S>-${slug}.org"
                          "#+TITLE: ${title}\n")
               :unnarrowed t)
              ("b" "bookref" plain
               (file "~/.config/chemacs/dotemacsen/Reza/orgtemplates/bookRef.org")
               :if-new
               (file+head "noter/${citekey}.org"
                          "#+TITLE: bref-${title}\n")
               :unnarrowed t)
              ("a" "articref" plain
               (file "~/.config/chemacs/dotemacsen/Reza/orgtemplates/articRef.org")
               :if-new
               (file+head "noter/${citekey}.org"
                          "#+TITLE: aref-${title}\n")
               :unnarrowed t)
              ("p" "people" plain
               (file "~/.config/chemacs/dotemacsen/Reza/orgtemplates/roamPeople.org")
               :if-new
               (file+head "%<%Y%m%d%H%M%S>-${slug}.org"
                          "#+TITLE: ${title}\n")
               :unnarrowed t))))
#+end_src

***** Web Capture
#+begin_src emacs-lisp
  (after! org-roam
        (setq org-roam-capture-ref-templates
              '(("r" "ref" plain
                 (file "~/.config/chemacs/dotemacsen/Reza/orgtemplates/webRef.org")
                 :if-new
                 (file+head "web/%<%Y%m%d%H%M%S>-${slug}.org"
                            "#+TITLE: web-${title}\n")
                 :unnarrowed t))))
#+end_src

Make sure to have this bookmarklet set up
#+begin_src javascript :tangle no
  javascript:location.href =
      'org-protocol://roam-ref?template=r&ref='
      + encodeURIComponent(location.href)
      + '&title='
      + encodeURIComponent(document.title)
      + '&body='
      + encodeURIComponent(window.getSelection())
#+end_src

**** Graph Viewer

***** Built-in Graphing
#+begin_src emacs-lisp
  (after! org-roam
    (setq org-roam-graph-viewer "librewolf"))
#+end_src

***** Better Graph (org-roam-ui)

****** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! org-roam-ui
   :recipe (:host github
            :repo "org-roam/org-roam-ui"
            :files ("*.el" "out")))
#+end_src

****** Configuration
#+begin_src emacs-lisp
  (use-package! org-roam-ui
    :preface
    (use-package! websocket)
    (use-package! simple-httpd)
    :after org-roam
  ;;         normally we'd recommend hooking orui after org-roam, but since org-roam does not have
  ;;         a hookable mode anymore, you're advised to pick something yourself
  ;;         if you don't care about startup time, use
  ;;  :hook (after-init . org-roam-ui-mode)
    :config
    (setq org-roam-ui-sync-theme t
          org-roam-ui-follow t
          org-roam-ui-update-on-save t
          org-roam-ui-open-on-start t))

#+end_src

**** Protocol

***** Protocol Setup
#+begin_src emacs-lisp
  (after! org
    (require 'org-protocol)
    (require 'org-roam-protocol)

  ;; This part is taken from nobiot's fix org-protocol interaction with chrome in "Zero To Emacs"
    (load-file (expand-file-name "elisp/+org-protocol-check-filename-for-protocol.el" doom-private-dir))
    (advice-add 'org-protocol-check-filename-for-protocol :override '+org-protocol-check-filename-for-protocol))
#+end_src

**** COMMENT Dailies

***** Directory
#+begin_src emacs-lisp
  (after! org-roam
    (setq org-roam-dailies-directory "daily/"))
#+end_src

***** Org-Roam-Dailies-Capture
to capture notes idea to be incorporated to org  roam
#+begin_src emacs-lisp
  (after! org-roam
    (setq org-roam-dailies-capture-templates
        '(("j" "journal" entry
           #'org-roam-capture--get-point
           "* %?"
           :file-name "journal/%<%Y-%m-%d>"
           :head "#+TITLE:Daily Journal\n#+date_created:%<%A, %d-%h-%Y>\n#+roam_tags:\n\n"
           :olp ("Journal"))
          ("i" "insights" entry
           #'org-roam-capture--get-point
           "* %?"
           :file-name "insights/%<%Y-%m-%d>"
           :head "#+TITLE:Daily Insight\n#+date_created:%<%A, %d-%h-%Y>\n#+roam_tags:\n\n"
           :olp ("Insights")))))
#+end_src
- Extra options
  + :dir-name -> like :file-name, but only for defining sub-directories
  + :header -> customize file header

**** COMMENT Doctor
#+begin_src emacs-lisp
  (after! org-roam
    '(make-org-roam-doctor-checker
   :name 'org-roam-doctor-broken-links
   :description "Fix broken links."
   :actions '(("d" . ("Unlink" . org-roam-doctor--remove-link))
              ("r" . ("Replace link" . org-roam-doctor--replace-link))
              ("R" . ("Replace link (keep label)" . org-roam-doctor--replace-link-keep-label)))))
#+end_src

**** Extensions

***** Bibtex

****** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! org-roam-bibtex)
#+end_src

****** Configuration
#+begin_src emacs-lisp
  (use-package! org-roam-bibtex
    :defer t
    ;; :after org
    :config
    (require 'org-ref)
    (org-roam-bibtex-mode 1))
#+end_src

***** COMMENT Mathpix
#+begin_src emacs-lisp
  (use-package! mathpix.el
    :straight (:host github :repo "jethrokuan/mathpix.el")
    :custom ((mathpix-app-id "app-id")
             (mathpix-app-key "app-key"))
    :bind
    ("C-x m" . mathpix-screenshot))
#+end_src

***** COMMENT Delve
#+begin_src emacs-lisp
  (use-package! lister
    :straight (lister :type git
                      :host github
                      :repo "publicimageltd/lister"))

  (use-package! delve
    :straight (delve :type git
                     :host github
                     :repo "publicimageltd/delve")
    :config
    (use-package! delve-minor-mode
      :straight nil
      :config
      (add-hook 'org-mode-hook #'delve-minor-mode-maybe-activate))
    :bind
    (("<f10>" . delve-open-or-select)))
#+end_src

*** Sort-Task

**** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! org-sort-task :recipe
      (:host github
       :repo "felipelalli/org-sort-tasks"
       :files ("org-sort-tasks.el")))
#+end_src

**** Configuration
#+begin_src emacs-lisp
  (use-package! org-sort-tasks
    :commands org-sort-tasks)
#+end_src

*** Transclusion
By @nobiot, Transcluding between files using Org-ID

**** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! org-transclusion :recipe
       (:host github
        :repo "nobiot/org-transclusion"))
#+end_src

**** Configuration
#+begin_src emacs-lisp
  (use-package! org-transclusion
    :hook (org-mode . (lambda () (org-transclusion-mode)))
    :commands (org-transclusion-add)
    :config
    (set-face-attribute 'org-transclusion-fringe nil :foreground "green" :background "green")
    (set-face-attribute 'org-transclusion nil :inherit 'org-block))
#+end_src

*** Noter

**** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! org-noter)
#+end_src

**** Configuration
#+begin_src emacs-lisp
  (use-package! org-noter
    ;; :after (:any org pdf-view)
    :config
    (setq
     ;; The WM can handle splits
     org-noter-notes-window-location 'other-frame
     ;; Please stop opening frames
     org-noter-always-create-frame nil
     ;; I want to see the whole file
     org-noter-hide-other nil
     ;; Everything is relative to the main notes file
     org-noter-notes-search-path (list org_noter))

    (evil-define-key 'normal org-noter-notes-mode-map (kbd "S <tab>") 'org-noter-sync-current-note))

#+end_src

*** Journal

**** Configuration
#+begin_src emacs-lisp
  (use-package! org-journal
    :after org
    :hook (org-journal-mode . (lambda () (emojify-mode)))
    :commands
    (org-journal-open-current-journal-file
     org-journal-search-forever
     org-journal-search-calendar-week
     org-journal-search-calendar-month
     org-journal-search-calendar-year)
    :config
    (setq org-journal-carryover-items ""
          org-journal-enable-cache t
          org-journal-enable-encryption t
          org-journal-encrypt-journal t))
#+end_src

**** Directory
#+begin_src emacs-lisp
  (after! org-journal
      (setq org-journal-dir org_journal
            org-journal-file-format "%Y-%m-%d.org"
            org-journal-date-prefix "#+DATE: "
            org-journal-date-format "%A, %d %B %Y"
            org-extend-today-until 4))
#+end_src

**** Journal Header
#+begin_src emacs-lisp
  (defun org-journal-file-header-func (time)
    (concat
      (pcase org-journal-file-type
        (`daily "#+TITLE: Reza's Daily Journal\n#+STARTUP: content")
        (`weekly "#+TITLE: Reza's Weekly Journal\n#+STARTUP: folded")
        (`monthly "#+TITLE: Reza's Monthly Journal\n#+STARTUP: folded")
        (`yearly "#+TITLE: Reza's Yearly Journal\n#+STARTUP: folded"))))

  (after! org-journal
  (setq org-journal-file-header 'org-journal-file-header-func))
#+end_src

**** Upload Image
#+begin_src emacs-lisp
  ;; Uploading Images to Journal
  (defun rz/img-path-string (date)
    (interactive)
    (mapconcat (function (lambda (x) (concat (concat "\[\[" x) "\]\]\n")))
               (seq-filter (function (lambda (x) (cl-search date x)))
                           (directory-files-recursively "~/Pictures/wallpapers/"
                                                        "\\`[^.].*\\.jpg\\'"
                                                        )
                           )
               ""
               )
    )

  (defun rz/upload-imgs-to-journal ()
    "I use this function to attach images to the journal for the date that I choose"
    (interactive)
    (let ((date
           (replace-regexp-in-string "[^[:digit:]]" "" (org-read-date))))

      (append-to-file
       (concat "* Images\n" (rz/img-path-string date))
       nil
       (concat org-journal-dir (concat date ".org"))
       )
      )
    )
#+end_src

**** Capture

***** Scheduled Entry
Function linked to Capture Template to look for scheduled entry
#+begin_src emacs-lisp
  (defvar org-journal--date-location-scheduled-time nil)
  (defun org-journal-date-location (&optional scheduled-time)
    (let ((scheduled-time (or scheduled-time (org-read-date nil nil nil "Date:"))))
      (setq org-journal--date-location-scheduled-time scheduled-time)
      (org-journal-new-entry t (org-time-string-to-time scheduled-time))
      (unless (eq org-journal-file-type 'daily)
        (org-narrow-to-subtree))
      (goto-char (point-max))))
#+end_src

***** Today Entry per org-capture template
#+begin_src emacs-lisp
  (defun rz/org-journal-today-entry-new ()
    "Insert new entry using org-roam-capture template"
    (interactive)
    (org-capture nil "jj"))
#+end_src

**** Search Journal
#+begin_src emacs-lisp
(defun rz/org-journal-find-location ()
  ;; Open today's journal, but specify a non-nil prefix argument in order to
  ;; inhibit inserting the heading; org-capture will insert the heading.
  (org-journal-new-entry t)
  ;; Position point on the journal's top-level heading so that org-capture
  ;; will add the new entry as a child entry.
  (goto-char (point-min)))
#+end_src

**** Save on Kill
Simple convenience function. Saves the buffer of the current day's entry and kills the window similar to org-capture like behavior
#+begin_src emacs-lisp
   (defun org-journal-save-entry-and-exit()
      (interactive)
      (save-buffer)
      (kill-buffer-and-window))

  (after! org-journal
    (define-key org-journal-mode-map (kbd "C-c C-c") 'org-journal-save-entry-and-exit))
#+end_src

*** Sidebar

**** Configuration
#+begin_src emacs-lisp
  (use-package! org-sidebar
    :commands org-sidebar-toggle)
#+end_src

*** Cliplink
#+begin_src emacs-lisp
  (use-package! org-cliplink
    :commands (org-cliplink org-cliplink-capture))
#+end_src

*** Chef
#+begin_src emacs-lisp
  (use-package! org-chef
    :commands (org-chef-insert-recipe org-chef-edit-servings))
#+end_src

*** Pomodoro

**** Configuration
#+begin_src emacs-lisp
  (use-package! org-pomodoro
    :commands org-pomodoro
    :config
    (setq
     alert-user-configuration
     (quote ((((:category . "org-pomodoro")) libnotify nil)))
     org-pomodoro-length 25
     org-pomodoro-short-break-length 5))
#+end_src

**** Function for outside Emacs
#+begin_src emacs-lisp
  (after! org-pomodoro
    (defun rz/org-pomodoro-time ()
    "Return the remaining pomodoro time"
    (if (org-pomodoro-active-p)
        (cl-case org-pomodoro-state
          (:pomodoro
             (format "%d minutes - %s" (/ (org-pomodoro-remaining-seconds) 60) org-clock-heading))
          (:short-break
           (format "Short Break: %d minutes" (/ (org-pomodoro-remaining-seconds) 60)))
          (:long-break
           (format "Long Break: %d minutes" (/ (org-pomodoro-remaining-seconds) 60)))
          (:overtime
           (format "Overtime! %d minutes" (/ (org-pomodoro-remaining-seconds) 60))))
      "No active pomo")))
#+end_src

*** Download :bindproblem:
For drag and drop capability in org
#+begin_src emacs-lisp
  (use-package! org-download
    :hook (dired-mode . (lambda () (org-download-enable)))
    :init
    (setq
     org-download-image-dir (concat org_file_dir "images/")
     org-download-method 'directory
     org-download-heading-lvl nil
     org-download-backend "wget"))
    ;; :bind
    ;; (:map org-mode-map
    ;;       (("s-Y" . org-download-screenshot)
    ;;        ("s-y" . org-download-yank))))
#+end_src

*** Pandoc Import
Import files for viewing in org mode

**** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! org-pandoc-import
   :recipe (:host github
            :repo "tecosaur/org-pandoc-import"
            :files ("*.el" "filters" "preprocessors")))
#+end_src

**** Configuration
#+begin_src emacs-lisp
  (use-package! org-pandoc-import
    :after org)
#+end_src

*** Recoll Integration

**** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! org-recoll)
#+end_src

**** Configuration
#+begin_src emacs-lisp
  (use-package! org-recoll
    :commands
    (org-recoll-search
     org-recoll-update-index)
    :config
    (evil-define-key
      'normal org-recoll-mode-map
      (kbd "g ]") 'org-recoll-next-page
      (kbd "g [") 'org-recoll-previous-page
      (kbd "q") 'delete-window)
    )
#+end_src

*** Randomnote
To open random journal entry

**** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! org-randomnote)
#+end_src
**** Configuration
#+begin_src emacs-lisp
  (use-package! org-randomnote
    ;; :bind ("C-c r". org-randomnote)
    :config
    (load-library "find-lisp")
    (setq org-randomnote-candidates
          (find-lisp-find-files org_journal "\.org$")))
#+end_src


** Asynchronous Export

*** Async Init file

**** COMMENT With Package.el
#+begin_src emacs-lisp  :tangle ./elisp/ox-init.el :mkdirp yes
;;; ox-init.el -*- lexical-binding: t; -*-
; This is configuration for asynchronous
; exporting for org files

(require 'package)
(setq package-enable-at-startup nil)
(package-initialize)

(defvar doom-private-dir (concat (getenv "HOME") "/.config/doom"))
(load-file (expand-file-name "./elisp/variables.el" doom-private-dir))

(require 'cl)
(require 'org)
(with-eval-after-load 'org
  (setq org-id-locations-file (expand-file-name ".orgids" org-directory))
  (require 'org-transclusion)
  (require 'org-ref)
  (setq bibtex-completion-bibliography bib_files)
  (setq reftex-default-bibliography bib_files)
  (require 'oc)
  (setq org-cite-global-bibliography bib_files)
  (setq citar-bibliography bib_files)
  (require 'ox)
  (with-eval-after-load 'ox
    (require 'ox-extra)
    (ox-extras-activate '(latex-header-blocks ignore-headlines))
    (setq org-export-async-debug t))
  (require 'ox-latex)
  (with-eval-after-load 'ox-latex
   (add-to-list 'org-latex-packages-alist '("" "minted"))
   (setq org-latex-listings 'minted)
   (add-to-list 'org-latex-minted-langs '(ipython "python"))))
#+end_src

**** With Straight.el
#+begin_src emacs-lisp  :tangle ./elisp/ox-init.el :mkdirp yes
;;; ox-init.el -*- lexical-binding: t; -*-
; This is minimal configuration for asynchronous exporting for org files, edit on
; `../config.org'

(setq-default user-emacs-directory (concat (getenv "HOME") "/.config/chemacs/dotemacsen/doom/"))
(setq-default doom-private-dir (concat (getenv "HOME") "/.config/doom/"))

(load-file (expand-file-name "elisp/variables.el" doom-private-dir))

(defvar bootstrap-version)
(let ((bootstrap-file
       ;; I use `.local' to reuse the previous repos pulled `doom-emacs'
       (expand-file-name ".local/straight/repos/straight.el/bootstrap.el" user-emacs-directory))
      (bootstrap-version 6))
  (unless (file-exists-p bootstrap-file)
    (with-current-buffer
        (url-retrieve-synchronously
         "https://raw.githubusercontent.com/radian-software/straight.el/develop/install.el"
         'silent 'inhibit-cookies)
      (goto-char (point-max))
      (eval-print-last-sexp)))
  (load bootstrap-file nil 'nomessage))

(defun straight-reload-init ()
  "Reload init.el."
  (interactive)
  (straight-transaction
   (straight-mark-transaction-as-init)
   (message "Reloading init.el...")
   (load user-init-file nil 'nomessage)
   (message "Reloading init.el... done.")))

;;;;;;;;;;;;;;;;;
;; use-package ;;
;;;;;;;;;;;;;;;;;

;; Use-package is a declarative package configurator.
;; We need to set some configurations before "requiring" use-package, so that it
;; integrates better with imenu and this init file.
(setq-default use-package-enable-imenu-support t
              use-package-form-regexp-eval
              `(concat ,(eval-when-compile
                          (concat "^\\s-*("
                                  (regexp-opt '("use-package" "use-feature" "require") t)
                                  "\\s-+\\("))
                       (or (bound-and-true-p lisp-mode-symbol-regexp)
                           "\\(?:\\sw\\|\\s_\\|\\\\.\\)+") "\\)"))

;; Call straight-use-package to bootstrap use-package so we can use it.
(straight-use-package 'use-package)

(defmacro use-feature (name &rest args)
  "Like `use-package', but with `straight-use-package-by-default' disabled."
  (declare (indent defun))
  `(use-package ,name
     :straight nil
     ,@args))

;; When configuring a feature with `use-package', also tell
;; straight.el to install a package of the same name, unless otherwise
;; specified using the `:straight' keyword.
(setq-default straight-use-package-by-default t)

;; Tell `use-package' to always load features lazily unless told
;; otherwise. It's nicer to have this kind of thing be deterministic:
;; if `:demand' is present, the loading is eager; otherwise, the
;; loading is lazy. See
;; https://github.com/jwiegley/use-package#notes-about-lazy-loading.
(setq-default use-package-always-defer t)

;;;;;;;;;;;;;;
;; Org Mode ;;
;;;;;;;;;;;;;;

;; Our real configuration for Org comes much later. Doing this now
;; means that if any packages that are installed in the meantime
;; depend on Org, they will not accidentally cause the Emacs-provided
;; (outdated and duplicated) version of Org to be loaded before the
;; real one is registered.
(use-package org)
;; Here we guarantee that org mode gets loaded properly.
(use-package org-contrib)
;; Here we guarantee that org mode gets loaded properly.

(use-feature org
 :config
 (setq-default org-catch-invisible-edits 'smart
               org-special-ctrl-a/e t
               org-image-actual-width '(400)
               org-return-follows-link t
               org-list-allow-alphabetical t
               ;; Aesthetics
               org-blank-before-new-entry '((heading . t) (plain-list-item . nil))
               org-fontify-quote-and-verse-blocks t
               org-hide-macro-markers nil
               org-fontify-whole-heading-line t
               org-fontify-done-headline t
               org-hide-emphasis-markers nil
               org-highlight-latex-and-related '(latex)
               ;; Image display
               org-image-actual-width '(400)))

(use-feature org-src
  :after org
  :demand t
  :config
  (setq-default org-edit-src-content-indentation 0
                org-src-preserve-indentation t
                org-src-fontify-natively t))

(use-feature ob
  :after org
  :demand t
  :config
  (setq-default org-confirm-babel-evaluate nil
                org-confirm-elisp-link-function nil
                org-confirm-shell-link-function nil)

  (dolist (language '((org . t)
                      (python . t)
                      (matlab . t)
                      (shell . t)
                      (latex . t)))
    (add-to-list 'org-babel-load-languages language))
  (org-babel-do-load-languages 'org-babel-load-languages org-babel-load-languages)

  :hook (org-babel-after-execute . org-display-inline-images))

(use-feature ox
  :after org
  :demand t
  :config
  ;; This is so that we are not queried if bind-keywords are safe when we set
  ;; org-export-allow-bind to t.
  (put 'org-export-allow-bind-keywords 'safe-local-variable #'booleanp)
  (setq org-export-with-sub-superscripts '{}
        org-export-coding-system 'utf-8
        org-html-checkbox-type 'html))

(use-feature org-attach
  :after org
  :demand t)

(use-feature ox-latex
  :after ox
  :demand t
  :init
  ;; Instead of using the long commands it is better to just use `latexmk', make
  ;; sure `latexmkrc' have properly set up with `makeglossaries' and `makeindex'
  (setq org-latex-pdf-process
        '("latexmk -pdflatex='pdflatex -shell-escape -interaction nonstopmode' -pdf -bibtex -f %f"
          ;; This is for regeneretable files cleanup
          "latexmk -pdflatex='pdflatex -shell-escape -interaction nonstopmode' -pdf -bibtex -f -c %f"))
  ;; these `setq's required by `org-ref' to include index, glossaries and acronym
  (setq org-export-before-parsing-functions
        '(org-latex-header-blocks-filter
          org-attach-expand-links
          org-ref-glossary-before-parsing
          org-ref-acronyms-before-parsing))
  ;; (setq org-latex-pdf-process
  ;;         '("pdflatex -shell-escape -interaction nonstopmode -output-directory %o %f"
  ;;           "bibtex %b"
  ;;           "makeglossaries %b"
  ;;           "makeindex %b"
  ;;           "pdflatex -shell-escape -interaction nonstopmode -output-directory %o %f"
  ;;           "splitindex %b -s oscola"
  ;;           "pdflatex -shell-escape -interaction nonstopmode -output-directory %o %f"))
  :config

  ;; Sometimes it's good to locally override these two.
  (put 'org-latex-title-command 'safe-local-variable #'stringp)
  (put 'org-latex-toc-command 'safe-local-variable #'stringp)

  ;; Need to let ox know about ipython and jupyter
  (add-to-list 'org-latex-minted-langs '(ipython "python"))
  (add-to-list 'org-babel-tangle-lang-exts '("ipython" . "py"))
  (add-to-list 'org-latex-minted-langs '(jupyter-python "python"))
  (add-to-list 'org-babel-tangle-lang-exts '("jupyter-python" . "py"))

  ;; Default article class but no added package
  (add-to-list 'org-latex-classes
                    '("articlenopack"
                      "\\documentclass{articlenopack}
 [NO-DEFAULT-PACKAGES]
 [PACKAGES]
 [EXTRA]"
                      ("\\section{%s}" . "\\section*{%s}")
                      ("\\subsection{%s}" . "\\subsection*{%s}")
                      ("\\subsubsection{%s}" . "\\subsubsection*{%s}")
                      ("\\paragraph{%s}" . "\\paragraph*{%s}")
                      ("\\subparagraph{%s}" . "\\subparagraph*{%s}")))
  ;; Mimore class is a latex class for writing articles.
  (add-to-list 'org-latex-classes
               '("mimore"
                 "\\documentclass{mimore}
 [NO-DEFAULT-PACKAGES]
 [PACKAGES]
 [EXTRA]"
                 ("\\section{%s}" . "\\section*{%s}")
                 ("\\subsection{%s}" . "\\subsection*{%s}")
                 ("\\subsubsection{%s}" . "\\subsubsection*{%s}")
                 ("\\paragraph{%s}" . "\\paragraph*{%s}")
                 ("\\subparagraph{%s}" . "\\subparagraph*{%s}")))

  ;; Mimosis is a class I used to write my Ph.D. thesis.
  (add-to-list 'org-latex-classes
               '("mimosis"
                 "\\documentclass{mimosis}
 [NO-DEFAULT-PACKAGES]
 [PACKAGES]
 [EXTRA]
\\newcommand{\\mboxparagraph}[1]{\\paragraph{#1}\\mbox{}\\\\}
\\newcommand{\\mboxsubparagraph}[1]{\\subparagraph{#1}\\mbox{}\\\\}"
                 ("\\chapter{%s}" . "\\chapter*{%s}")
                 ("\\section{%s}" . "\\section*{%s}")
                 ("\\subsection{%s}" . "\\subsection*{%s}")
                 ("\\subsubsection{%s}" . "\\subsubsection*{%s}")
                 ("\\mboxparagraph{%s}" . "\\mboxparagraph*{%s}")
                 ("\\mboxsubparagraph{%s}" . "\\mboxsubparagraph*{%s}")))

  ;; Elsarticle is Elsevier class for publications.
  (add-to-list 'org-latex-classes
               '("elsarticle"
                 "\\documentclass{elsarticle}
 [NO-DEFAULT-PACKAGES]
 [PACKAGES]
 [EXTRA]"
                 ("\\section{%s}" . "\\section*{%s}")
                 ("\\subsection{%s}" . "\\subsection*{%s}")
                 ("\\subsubsection{%s}" . "\\subsubsection*{%s}")
                 ("\\paragraph{%s}" . "\\paragraph*{%s}")
                 ("\\subparagraph{%s}" . "\\subparagraph*{%s}")))

  (setq org-latex-prefer-user-labels t))

;; Feature `ox-extra' is a library from the org-plus-contrib package.
;; It adds extra keywords and tagging functionality for org export.
(use-feature ox-extra
  ;; Demand so that ignore headlines is always active.
  :demand t
  :after ox
  ;; The ignore-headlines allows Org to understand the tag :ignore: and simply
  ;; remove tagged headings on export, but leave their content in.
  ;; See my blog post about writing thesis with org mode here:
  ;; https://write.as/dani/writing-a-phd-thesis-with-org-mode
  :config (ox-extras-activate '(ignore-headlines)))

(use-package org-transclusion
  :after org
  :demand t
  :straight (org-transclusion :host github
                              :repo "nobiot/org-transclusion"))

;; The `org-ref' package adds functionality to manage, insert and navigate
;; citations (and other references as well, such as equations) within Org mode.
(use-package org-ref
  :straight (org-ref :type git :host github :repo "jkitchin/org-ref")
  :after org
  :demand t ;; Ensure that it loads so that links work immediately.
  :config
  (setq reftex-default-bibliography bib_files
        bibtex-completion-bibliography bib_files
        bibtex-completion-pdf-field "file"
        org-ref-default-citation-link "parencite"))

;;;;;;;;;;;
;; Latex ;;
;;;;;;;;;;;

(use-package auctex)
(use-feature tex
  :config
  (setq-default TeX-auto-save t
                TeX-PDF-mode t
                Tex-show-compilation nil
                TeX-parse-self t)
  :hook ((LaTeX-mode . visual-line-mode)
         (LaTeX-mode . (lambda ()
                         (add-to-list
                          'TeX-command-list
                          '("XeLaTeX" "%`xelatex%(mode)%' %t" TeX-run-TeX nil t))))))

(use-feature tex-buf
  :config
  (setq TeX-save-query nil))

(use-package company-auctex
  :demand t
  :after (:all company tex)
  :config
  (company-auctex-init))

(use-package scimax-latex
  :straight (scimax-latex :type git
                          :host github
                          :repo "jkitchin/scimax"
                          :files ("scimax-latex.el"))
  :commands (scimax-latex-setup
             kpsewhich
             texdoc))
#+end_src
*** Keybinding
This setup keybinding for ~Org Export Stack~
#+begin_src emacs-lisp
(map! :map org-mode-map
      :localleader
      :desc "Open export async stack" "E" #'org-export-stack)

(map! :map org-export-stack-mode-map
      :ne "RET" #'org-export-stack-view
      :ne "d" #'org-export-stack-remove
      :ne "g r" #'org-export-stack-refresh)
#+end_src

*** Configuration

**** Call the init as async
#+begin_src emacs-lisp
(after! org
  (setq org-export-async-init-file (expand-file-name "elisp/ox-init.el" doom-private-dir)))
#+end_src

**** latexmkrc example
Here is ~latexmkrc~ file that include support for ~makeglossaries~ taken from [[https://tex.stackexchange.com/questions/1226/how-to-make-latexmk-use-makeglossaries][compiling - How to make Latexmk use makeglossaries? - TeX - LaTeX Stack Exchange]].
This code block is automatically tangled to ~~/.config/latexmk/latexmkrc~.  make sure to save your own configuration first before tangling this ~config.org~ file.
#+begin_src perl :tangle ~/.config/latexmk/latexmkrc
add_cus_dep('glo', 'gls', 0, 'run_makeglossaries');
add_cus_dep('acn', 'acr', 0, 'run_makeglossaries');

sub run_makeglossaries {
    my ($base_name, $path) = fileparse( $_[0] ); #handle -outdir param by splitting path and file, ...
    pushd $path; # ... cd-ing into folder first, then running makeglossaries ...

    if ( $silent ) {
        system "makeglossaries -q '$base_name'"; #unix
        # system "makeglossaries", "-q", "$base_name"; #windows
    }
    else {
        system "makeglossaries '$base_name'"; #unix
        # system "makeglossaries", "$base_name"; #windows
    };

    popd; # ... and cd-ing back again
}

push @generated_exts, 'glo', 'gls', 'glg';
push @generated_exts, 'acn', 'acr', 'alg';
$clean_ext .= ' %R.ist %R.xdy';
#+end_src

* EBook Reader

** CalibreDB

*** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! calibredb)
#+end_src

*** Configuration
#+begin_src emacs-lisp
    (use-package! calibredb
      :commands calibredb-find-counsel
      :init
      (autoload 'calibredb "calibredb")

      (setq calibredb-size-show t))

  (after! calibredb
    (setq calibredb-root-dir "~/Documents/Calibre")
    (setq calibredb-db-dir (expand-file-name "metadata.db" calibredb-root-dir)))
#+end_src

** PDF

*** Pdf-Tools

**** Configuration
#+begin_src emacs-lisp
  (use-package! pdf-tools
    :defer t
    ;; :mode "\\.pdf\\'"
    :config
    (add-to-list 'auto-mode-alist '("\\.pdf\\'" . pdf-view-mode))
    (add-hook 'pdf-tools-enabled-hook 'pdf-view-midnight-minor-mode)
        (evil-define-key
          'normal pdf-view-mode-map
          (kbd "q") 'kill-this-buffer
          (kbd "u") 'pdf-view-scroll-down-or-previous-page
          (kbd "d") 'pdf-view-scroll-up-or-next-page)
    (pdf-loader-install))
#+end_src

**** COMMENT Local-Leader Keybindings
Annotation set up
#+begin_src emacs-lisp
  (general-define-key
    :major-modes t
    :prefix rz/localleader-key
    :global-prefix rz/localleader-alt-key
    :states '(normal insert visual emacs)
    :keymaps 'pdf-annot-minor-mode-map
    ;; unbind prefix keys
     "" '(:ignore t :wk "<localleader>")

    ;; Annotations
    ;; "a" '(:ignore t :wk "links")
    "h" '(pdf-annot-add-highlight-markup-annotation :wk "annot-add-highlight")
    "s" '(pdf-annot-add-strikeout-markup-annotation :wk "annot-add-strikeout")
    "u" '(pdf-annot-add-underline-markup-annotation :wk "annot-add-underline")
    "s" '(pdf-annot-add-squiggly-markup-annotation :wk "annot-add-squiggly")
    "D" '(pdf-annot-delete  :wk "annot-delete")
    "t" '(pdf-annot-add-text-annotation :wk "annot-add-text")
    "a" '(pdf-annot-attachment-dired :wk "list-attachment-dired")
    "m" '(pdf-annot-add-markup-annotation :wk "annot-add-markup")
    "l" '(pdf-annot-list-annotations  :wk "list-annots")
    "d" '(lexic-search :wk "open-dictionary"))
#+end_src

*** Search Within PDF file

**** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! pdfgrep)
#+end_src

**** Configuration
#+begin_src emacs-lisp
  (use-package! pdfgrep
    :defer t)
#+end_src

** DJVU
Using built-in DocView mode

*** Configuration
#+begin_src emacs-lisp
  (use-package! doc-view
    :defer t
    :config
    (setq doc-view-continuous t)
    (add-to-list 'auto-mode-alist '("\\.djvu\\'" . doc-view-mode)))
#+end_src

** EPUB

*** Nov.el

**** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! nov)
#+end_src

**** Configuration
#+begin_src emacs-lisp
  (use-package! nov
    :preface
    (defun rz/nov-font-setup ()
      (interactive)
      (face-remap-add-relative
       'variable-pitch
       :family "Amazon Ember"
       :height 1.0)
      (visual-line-mode 1)
      (visual-fill-column-mode 1))
    ;; :mode ("\\.\\(epub\\|mobi\\)\\'" . (lambda () (nov-mode)))
    :config
    (setq nov-text-width t)
    (add-hook 'nov-mode-hook 'rz/nov-font-setup))
#+end_src

*** COMMENT Justify-kp

**** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! justify-kp :recipe
      (:host github
       :repo "Fuco1/justify-kp"
       :files ("justify-kp.el")))
#+end_src

**** Configuration
#+begin_src emacs-lisp
  (use-package! justify-kp
    :after nov)

  (defun rz/nov-window-configuration-change-hook ()
    (rz/nov-post-html-render-hook)
    (remove-hook 'window-configuration-change-hook
                 'rz/nov-window-configuration-change-hook
                 t))

  (defun rz/nov-post-html-render-hook ()
    (interactive)
    (if (get-buffer-window)
        (let ((max-width (pj-line-width))
              buffer-read-only)
          (save-excursion
            (goto-char (point-min))
            (while (not (eobp))
              (when (not (looking-at "^[[:space:]]*$"))
                (goto-char (line-end-position))
                (when (> (shr-pixel-column) max-width)
                  (goto-char (line-beginning-position))
                  (pj-justify)))
              (forward-line 1))))
      (add-hook 'window-configuration-change-hook
                'rz/nov-window-configuration-change-hook
                nil t)))

  (add-hook 'nov-post-html-render-hook 'rz/nov-post-html-render-hook)
#+end_src

* Calendar
#+begin_src emacs-lisp
  (use-package! calendar
    :init
    (general-setq holiday-islamic-holidays t)
    (general-setq holiday-hebrew-holidays nil)
    (general-setq calendar-chinese-all-holidays-flag nil)
    (general-setq holiday-solar-holidays nil)
    (general-setq holiday-bahai-holidays nil)
    :config
    (evil-define-key 'normal calendar-mode-map (kbd "J") 'org-journal-read-entry))
#+end_src

* Weather
Weather dashboard  taken from @tecosaur github

** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! wttrin
    :recipe (:host github
             :repo "tecosaur/emacs-config"
             :files ("lisp/wttrin/wttrin.el")))
#+end_src

** Configuration
#+begin_src emacs-lisp
  (use-package! wttrin
    :commands wttrin)
#+end_src

* Communication

** E-Mail Management

*** Notmuch
Configuration taken from [[https://www.ying-ish.com/essay/emacs-notmuch-mbsync-msmtp-email/][Ying Ish - notmuch+mbsync+msmtp]]

**** Configuration
#+begin_src emacs-lisp
  (use-package! notmuch
    :init
    (setq message-directory
          (expand-file-name mail_dir))
    (setq send-mail-function 'sendmail-send-it)
    ;; Send from correct email account
    (setq message-sendmail-f-is-evil t)
    ;; (setq message-sendmail-extra-arguments '("--read-envelope-from"))
    (setq mail-specify-envelope-from t)
    (setq mail-envelope-from 'header)
    (setq message-sendmail-envelope-from 'header)
    :config
    (setq sendmail-program
          (executable-find "msmtp"))
    (setq notmuch-show-logo nil)
    ;; Writing email
    (setq message-default-mail-headers "Cc: \nBcc: \n") ;; Always show BCC
    (setq notmuch-always-prompt-for-sender t)
    ;; PGP Encryption
    ;; (add-hook 'message-setup-hook 'mml-secure-sign-pgpmime)
    ;; (setq notmuch-crypto-process-mime t)
    ;; postponed message is put in the following draft directory
    (setq message-auto-save-directory
          (expand-file-name draft_dir))
    (setq message-kill-buffer-on-exit t)
    ;; Saving sent mail in folders depending on from
    (setq notmuch-fcc-dirs
          '(("mnurrreza@gmail.com" . "mnurrreza-gmail/Sent")
            ("mnurreza@yahoo.co.id" . "mnurreza-yahoo/Sent")))
    ;; Show all tags in *notmuch-hello*
    (setq notmuch-show-all-tags-list t)
    (setq notmuch-search-oldest-first nil)
    (setq notmuch-show-indent-content nil)
    (setq notmuch-archive-tags '("-inbox", "-unread", "+archived"))
    (setq notmuch-saved-searches
          '((:name "unread"
                   :query "tag:unread"
                   :key "u"
                   :sort-order newest-first
                   :search-type 'tree)
            (:name "inbox-gmail"
                   :query "tag:inbox to:mnurrreza@gmail.com"
                   :key "g"
                   :sort-order newest-first
                   :search-type 'tree)
            (:name "inbox-yahoo"
                   :query "tag:inbox to:mnurreza@yahoo.co.id"
                   :key "y"
                   :sort-order newest-first
                   :search-type 'tree)
            (:name "inbox-uni"
                   :query "tag:inbox to:muhammad.nur.reza.amasyi@mail.ugm.ac.id"
                   :key "U"
                   :sort-order newest-first
                   :search-type 'tree)
            (:name "flagged"
                   :query "tag:flagged"
                   :key "f"
                   :sort-order newest-first)
            (:name "sent"
                   :query "tag:sent"
                   :key "t"
                   :sort-order newest-first)
            (:name "drafts"
                   :query "tag:draft"
                   :key "d"
                   :sort-order newest-first)
            (:name "all mail"
                   :query "*"
                   :key "a"
                   :sort-order newest-first
                   :search-type 'tree)))
    )
#+end_src

**** Integration with Org

***** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! ol-notmuch)
#+end_src

***** Configuration
#+begin_src emacs-lisp
  (use-package! ol-notmuch)
#+end_src

**** Visualize Mail Directory

***** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! notmuch-maildir)
#+end_src

***** Configuration
#+begin_src emacs-lisp
  (use-package! notmuch-maildir
    :after notmuch
    :init
    (notmuch-maildir-inject-section))
#+end_src

**** Bookmark integration

***** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! notmuch-bookmarks)
#+end_src

***** Configuration
#+begin_src emacs-lisp
  (use-package! notmuch-bookmarks
    :after notmuch
    :config
    (notmuch-bookmarks-mode))
#+end_src

*** Contact Management (bbdb)

**** Configuration
#+begin_src emacs-lisp
  (use-package! bbdb
    :hook (bbdb-mode . (lambda () (evil-mode)))
    :custom
    (bbdb-mua-auto-update-p 'query)
    :config
    (setq bbdb-file (expand-file-name "bbdb/bbdb.el" org_file_dir))
    (add-hook 'mail-setup-hook 'bbdb-mail-aliases)
    (add-hook 'message-setup-hook 'bbdb-mail-aliases))
#+end_src

**** Keybinding
#+begin_src emacs-lisp
  (after! bbdb
    (evil-define-key 'normal bbdb-mode-map
      (kbd "s") 'bbdb-save
      (kbd "c") 'bbdb-create
      (kbd "?") 'bbdb-help
      (kbd "m") 'bbdb-mail
      (kbd "d") 'bbdb-dial
      (kbd "D") 'bbdb-delete-field-or-record
      (kbd "i") 'bbdb-insert-field
      (kbd "h") 'bbdb-info
      (kbd ";") 'bbdb-edit-foo
      (kbd "e") 'bbdb-edit-field
      (kbd "T") 'bbdb-display-records-completely
      (kbd "g d") 'bbdb-browse-url))
#+end_src

**** .vcard Contacts Handling

***** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! bbdb-vcard)
#+end_src

***** Configuration
#+begin_src emacs-lisp
  (use-package! bbdb-vcard
    :after bbdb)
#+end_src

**** Better Interface (counsel-bbdb)

***** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! counsel-bbdb)
#+end_src

***** Configuration
#+begin_src emacs-lisp
  (use-package! counsel-bbdb
    :defer t)
#+end_src

*** Org-Mime

**** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! org-mime)
#+end_src

**** Configuration
#+begin_src emacs-lisp
  (use-package! org-mime
    :commands notmuch-mua-new-mail
    :config
    (setq org-mime-export-options '(:section-numbers nil
                                  :with-author nil
                                  :with-toc nil)))
#+end_src

**** Style Blocks
#+begin_src emacs-lisp
  (after! org-mime
  (add-hook 'org-mime-html-hook
            (lambda ()
              (org-mime-change-element-style
               "pre" (format "color: %s; background-color: %s; padding: 0.5em;"
                             "#E6E1DC" "#232323"))))
  ;; the following can be used to nicely offset block quotes in email bodies
  (add-hook 'org-mime-html-hook
            (lambda ()
              (org-mime-change-element-style
               "blockquote" "border-left: 2px solid gray; padding-left: 4px;"))))
#+end_src

**** Confirm when send
#+begin_src emacs-lisp
  (after! message
    (add-hook 'message-send-hook 'org-mime-htmlize))
#+end_src

**** LaTeX and file link
Configuration taken from [[https://kitchingroup.cheme.cmu.edu/blog/2016/10/29/Sending-html-emails-from-org-mode-with-org-mime/][Kitchin RG - Equation and Email Attachment...]]
#+begin_src emacs-lisp
  (defun org-mime-compose (body fmt file &optional to subject headers)
    (require 'message)
    (let ((bhook
           (lambda (body fmt)
             (let ((hook (intern (concat "org-mime-pre-"
                                         (symbol-name fmt)
                                         "-hook"))))
               (if (> (eval `(length ,hook)) 0)
                   (with-temp-buffer
                     (insert body)
                     (goto-char (point-min))
                     (eval `(run-hooks ',hook))
                     (buffer-string))
                 body))))
          (fmt (if (symbolp fmt) fmt (intern fmt)))
          (files (org-element-map (org-element-parse-buffer) 'link
                   (lambda (link)
                     (when (string= (org-element-property :type link) "file")
                       (file-truename (org-element-property :path link)))))))
      (compose-mail to subject headers nil)
      (message-goto-body)
      (cond
       ((eq fmt 'org)
        (require 'ox-org)
        (insert (org-export-string-as
                 (org-babel-trim (funcall bhook body 'org)) 'org t)))
       ((eq fmt 'ascii)
        (require 'ox-ascii)
        (insert (org-export-string-as
                 (concat "#+TITLE:\n" (funcall bhook body 'ascii)) 'ascii t)))
       ((or (eq fmt 'html) (eq fmt 'html-ascii))
        (require 'ox-ascii)
        (require 'ox-org)
        (let* ((org-link-file-path-type 'absolute)
               ;; we probably don't want to export a huge style file
               (org-export-htmlize-output-type 'inline-css)
               (org-html-with-latex 'dvipng)
               (html-and-images
                (org-mime-replace-images
                 (org-export-string-as (funcall bhook body 'html) 'html t)))
               (images (cdr html-and-images))
               (html (org-mime-apply-html-hook (car html-and-images))))
          (insert (org-mime-multipart
                   (org-export-string-as
                    (org-babel-trim
                     (funcall bhook body (if (eq fmt 'html) 'org 'ascii)))
                    (if (eq fmt 'html) 'org 'ascii) t)
                   html)
                  (mapconcat 'identity images "\n")))))
      (mapc #'mml-attach-file files)))
#+end_src

** Slack

*** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! slack)
#+end_src

*** Configuration
#+begin_src emacs-lisp
  (use-package! slack
    :commands (slack-start)
    :init
    (setq slack-buffer-emojify t) ;; if you want to enable emoji, default nil
    (setq slack-prefer-current-team t)
    :config
    ;; (slack-register-team
    ;;  :name "emacs-slack"
    ;;  :default t
    ;;  :token "xoxs-sssssssssss-88888888888-hhhhhhhhhhh-jjjjjjjjjj"
    ;;  :subscribed-channels '(test-rename rrrrr)
    ;;  :full-and-display-names t)

    ;; (slack-register-team
    ;;  :name "test"
    ;;  :token "xoxs-yyyyyyyyyy-zzzzzzzzzzz-hhhhhhhhhhh-llllllllll"
    ;;  :subscribed-channels '(hoge fuga))

    (evil-define-key 'normal slack-info-mode-map
      ",u" 'slack-room-update-messages)
    (evil-define-key 'normal slack-mode-map
      ",c" 'slack-buffer-kill
      ",ra" 'slack-message-add-reaction
      ",rr" 'slack-message-remove-reaction
      ",rs" 'slack-message-show-reaction-users
      ",pl" 'slack-room-pins-list
      ",pa" 'slack-message-pins-add
      ",pr" 'slack-message-pins-remove
      ",mm" 'slack-message-write-another-buffer
      ",me" 'slack-message-edit
      ",md" 'slack-message-delete
      ",u" 'slack-room-update-messages
      ",2" 'slack-message-embed-mention
      ",3" 'slack-message-embed-channel
      "\C-n" 'slack-buffer-goto-next-message
      "\C-p" 'slack-buffer-goto-prev-message
     (evil-define-key 'normal slack-edit-message-mode-map
      ",k" 'slack-message-cancel-edit
      ",s" 'slack-message-send-from-buffer
      ",2" 'slack-message-embed-mention
      ",3" 'slack-message-embed-channel)))
#+end_src

*** Org-Export Integration

**** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! ox-slack)
#+end_src

**** Configuration
#+begin_src emacs-lisp
  (use-package! ox-slack
    :after ox)
#+end_src

*** Notification
#+begin_src emacs-lisp
  (use-package! alert
    :commands (alert)
    :init
    (setq alert-default-style 'libnotify))
#+end_src

** Circe

*** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! circe)
#+end_src

*** Configuration
#+begin_src emacs-lisp
  (use-package! circe
    :defer t)
#+end_src

** Twittering
#+begin_src emacs-lisp
  (use-package! twittering-mode
    :commands twit
    :config
    ;; Fix bug void-function
    (defalias 'epa--decode-coding-string 'decode-coding-string)
    (setq twittering-use-master-password t
          twittering-cert-file "/etc/ssl/certs/ca-certificates.crt"
          twittering-icon-mode t))
#+end_src

* File Explorer

** Dired

*** COMMENT Configuration
#+begin_src emacs-lisp
  (use-package! dired
    :commands (dired dired-jump)
    :bind (("C-x C-j" . dired-jump))
    :config
    (evil-collection-define-key 'normal 'dired-mode-map
      "h" 'dired-single-up-directory
      "l" 'dired-single-buffer)
    (setq dired-dwim-target t
          delete-by-moving-to-trash t
          dired-listing-switches "-alFh --group-directories-first"))

#+end_src

*** COMMENT Open using external files
#+begin_src emacs-lisp
  (use-package! dired-open
    :config
    (add-to-list 'dired-open-functions #'dired-open-xdg t)
    (setq dired-open-extensions '(("gif" . "sxiv")
                                ("jpg" . "sxiv")
                                ("png" . "sxiv")
                                ("html" . "foliate")
                                ("pdf" . "zathura")
                                ("azw3" . "foliate")
                                ("mobi" . "foliate")
                                ("epub" . "foliate")
                                ("mkv" . "mpv")
                                ("mp4" . "mpv"))))
#+end_src

*** COMMENT Only open one Buffer
#+begin_src emacs-lisp
  (use-package! dired-single
    :defer t)
#+end_src

*** COMMENT Cosmetic Improvements

**** Font Color
#+begin_src emacs-lisp
  (use-package! diredfl
    :hook (dired-mode . diredfl-mode))
#+end_src

**** Hide Dotfiles
#+begin_src emacs-lisp
  (use-package! dired-hide-dotfiles
    :hook (dired-mode . dired-hide-dotfiles-mode)
    :config
    (evil-collection-define-key 'normal 'dired-mode-map
      "H" 'dired-hide-dotfiles-mode))
#+end_src

*** COMMENT fd compatibility (fd-dired)
#+begin_src emacs-lisp
  (use-package! fd-dired
    :after dired)
**** Diff Information

***** Installation
#+begin_src emacs-lisp :tangle packages.el
(package! diff-hl)
#+end_src

***** Configuration
#+begin_src emacs-lisp
  (use-package! diff-hl
    :config
    (setq diff-hl-flydiff-delay 0.05)
    ;; use margin instead of fringe
    (diff-hl-margin-mode))

  (add-hook! 'dired-mode-hook #'diff-hl-dired-mode-unless-remote)
  (add-hook! 'magit-post-refresh-hook #'diff-hl-magit-post-refresh)
  (add-hook! 'prog-mode-hook #'diff-hl-mode)
  (add-hook! 'diff-hl-mode-hook #'diff-hl-flydiff-mode)
#+end_src

**** RSync Integration

***** Installation
#+begin_src emacs-lisp :tangle packages.el
(package! dired-rsync)
#+end_src

***** Keybindings
#+begin_src emacs-lisp
(map! :map dired-mode-map "C-c C-r" #'dired-rsync)
#+end_src

**** File Preview

***** Installation
#+begin_src emacs-lisp :tangle packages.el
(package! peep-dired)
#+end_src

***** Configuration
#+begin_src emacs-lisp
  (use-package! peep-dired
    :config
    (evil-define-key 'normal peep-dired-mode-map (kbd "g") 'peep-dired-scroll-page-down
                                               (kbd "G") 'peep-dired-scroll-page-up
                                               (kbd "j") 'peep-dired-next-file
                                               (kbd "k") 'peep-dired-prev-file)
    (add-hook 'peep-dired-hook 'evil-normalize-keymaps)
    (setq peep-dired-ignored-extensions '("mkv" "iso" "mp4")
          peep-dired-cleanup-eagerly t))
#+end_src

** Trash Management

*** Installation
#+begin_src emacs-lisp :tangle packages.el
(package! trashed)
#+end_src

*** Configuration
#+begin_src emacs-lisp
(map! :leader
      :desc "trashed" "ft" #'trashed)
#+end_src

** NotDeft

*** Installation
#+begin_src emacs-lisp :tangle packages.el
(package! notdeft
  :recipe
  (:host github
   :repo "hasu/notdeft"))
#+end_src

*** Configuration
#+begin_src emacs-lisp
  (use-package! notdeft
    :preface
    (defalias 'deft 'notdeft) ;; avoid Doom use of deft
    (defvar notdeft-directory nil)
    (defvar notdeft-directories nil)
    :config
    (add-to-list 'load-path (expand-file-name "straight/repos/notdeft/extras" straight-base-dir))
    (setq ;; Directory of xapian program must be absolute path
          notdeft-allow-org-property-drawers t ;; to treat :properties: on top as comment
          notdeft-directories '("~/org/roam")
          notdeft-xapian-home (expand-file-name "straight/repos/notdeft/xapian" straight-base-dir)
          notdeft-xapian-program (expand-file-name "straight/repos/notdeft/xapian/notdeft-xapian" straight-base-dir)
          notdeft-secondary-extensions '("md" "tex"))
    (evil-define-key 'normal notdeft-mode-map (kbd "q") 'quit-window))

  (add-hook! 'notdeft-load-hook #'notdeft-xapian-make-program-when-uncurrent)
#+end_src

** TRAMP
#+begin_src emacs-lisp
  (use-package! tramp
    :config
    (setenv "SHELL" "/bin/bash")
    (setq tramp-shell-prompt-pattern "\\(?:^\\|
  \\)[^]#$%>\n]*#?[]#$%>î°] *\\(ï¿½\\[[0-9;]*[a-zA-Z] *\\)*"))
#+end_src

** COMMENT Sudo-Edit
#+begin_src emacs-lisp
  (use-package! sudo-edit
    :commands ( sudo-edit
                sudo-edit-find-file ))
#+end_src

** Very Large File

*** Installation
#+begin_src emacs-lisp :tangle packages.el
(package! vlf)
#+end_src


*** Configuration
#+begin_src emacs-lisp
  (use-package! vlf
    :after dired
    :config
    (require 'vlf-setup))
#+end_src

* RSS Feeder

** Configuration
#+begin_src emacs-lisp
  (use-package! elfeed
    :preface
    ;; Watch Video Using MPV
    (defun rz/elfeed-v-mpv (url)
      "Watch a video from URL in MPV"
      (async-shell-command (format "mpv %s" url)))
    (defun rz/elfeed-view-mpv (&optional use-generic-p)
      "Youtube-feed link"
      (interactive "P")
      (let ((entries (elfeed-search-selected)))
        (cl-loop for entry in entries
                 do (elfeed-untag entry 'unread)
                 when (elfeed-entry-link entry)
                 do (rz/elfeed-v-mpv it))
        (mapc #'elfeed-search-update-entry entries)
        (unless (use-region-p) (forward-line))))

    ;; Download Video using yt-dlp
    (defun rz/yt-dlp-it (url)
      "Downloads the URL in an async shell"
      (let ((default-directory "~/Videos"))
        (async-shell-command (format "yt-dlp %s" url))))
    (defun rz/elfeed-youtube-dl (&optional use-generic-p)
      "Youtube-DL link"
      (interactive "P")
      (let ((entries (elfeed-search-selected)))
        (cl-loop for entry in entries
                 do (elfeed-untag entry 'unread)
                 when (elfeed-entry-link entry)
                 do (rz/yt-dl-it it))
        (mapc #'elfeed-search-update-entry entries)
        (unless (use-region-p) (forward-line))))

    ;; Send entry to email for later read
    (defun rz/mail-todo (text &optional body)
      (interactive "sTodo: ")
      (compose-mail-other-window "mnurrreza@gmail.com" text)
      (mail-text)
      (if body
          (insert body))
      (message-send-and-exit))
    (defun rz/elfeed-mail-todo (&optional use-generic-p)
      "Mail this to myself for later reading"
      (interactive "P")
      (let ((entries (elfeed-search-selected)))
        (cl-loop for entry in entries
                 do (elfeed-untag entry 'unread)
                 when (elfeed-entry-title entry)
                 do (rz/mail-todo it (elfeed-entry-link entry)))
        (mapc #'elfeed-search-update-entry entries)
        (unless (use-region-p) (forward-line))))
    :commands elfeed
    :config
    ;; (defface elfeed-show-title-face '((t (:weight ultrabold :slant italic :height 1.5)))
    ;;     "title face in elfeed show buffer"
    ;;     :group 'elfeed)
    ;; (defface elfeed-show-author-face `((t (:weight light)))
    ;;   "title face in elfeed show buffer"
    ;;   :group 'elfeed)
    ;; (set-face-attribute 'elfeed-search-title-face nil
    ;;                     :foreground 'nil
    ;;                     :weight 'light)
    (setf url-queue-timeout 30)
    (evil-define-key 'normal elfeed-search-mode-map
      (kbd "w") 'rz/elfeed-view-mpv
      (kbd "d") 'rz/yt-dlp-it
      (kbd "m") 'rz/elfeed-mail-todo
      (kbd "b") 'elfeed-show-visit
      (kbd "y") 'elfeed-show-yank
      (kbd "r") 'elfeed-search-tag-all-read
      (kbd "u") 'elfeed-search-tag-all-unread
      (kbd "U") 'elfeed-update
      (kbd "+") 'elfeed-search-tag-all
      (kbd "-") 'elfeed-search-untag-all)
    (elfeed-org))

(add-hook! 'elfeed-show-mode-hook
  (visual-line-mode 1)(visual-fill-column-mode 1)(mixed-pitch-mode 1))
#+end_src


** Extensions

*** Org Interface (elfeed-org)
#+begin_src emacs-lisp
  (after! elfeed-org
    (setq rmh-elfeed-org-files
          (list
           (expand-file-name
            "orgtemplates/elfeed.org"
            doom-private-dir))))

  (add-hook! 'elfeed-search-hook #'elfeed-org)
#+end_src

*** Goodies (elfeed-goodies)

**** Package Install
#+begin_src emacs-lisp :tangle packages.el
  (package! elfeed-goodies)
#+end_src

**** Configuration
#+begin_src emacs-lisp
  (use-package! elfeed-goodies
    :after elfeed
    :init
    (elfeed-goodies/setup)
    :config
    (evil-define-key 'normal elfeed-show-mode-map
      (kbd "J") 'elfeed-goodies/split-show-next
      (kbd "K") 'elfeed-goodies/split-show-prev)
    (evil-define-key 'normal elfeed-search-mode-map
      (kbd "J") 'elfeed-goodies/split-show-next
      (kbd "K") 'elfeed-goodies/split-show-prev))
#+end_src
*** Org-Web-Tools

**** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! org-web-tools)
#+end_src

**** Configuration
#+begin_src emacs-lisp
  (use-package! org-web-tools
    :after org)
#+end_src

* Calculator

** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! calctex :recipe
      (:host github
       :repo "johnbcoughlin/calctex"
       :files
       ("*.el"
        "calctex/*.el"
        "calctex-contrib/*.el"
        "org-calctex/*.el"
        "vendor")))
#+end_src

** Configuration
#+begin_src emacs-lisp
  (use-package! calctex
    :commands calctex-mode
    :init
    (add-hook 'calc-mode-hook #'calctex-mode))
  ;; :config
  ;;   (setq calctex-additional-latex-packages "
  ;; \\usepackage[usenames]{xcolor}
  ;; \\usepackage{soul}
  ;; \\usepackage{adjustbox}
  ;; \\usepackage{amsmath}
  ;; \\usepackage{amssymb}
  ;; \\usepackage{siunitx}
  ;; \\usepackage{cancel}
  ;; \\usepackage{mathtools}
  ;; \\usepackage{mathalpha}
  ;; \\usepackage{xparse}
  ;; \\usepackage{arevmath}"
  ;;         calctex-additional-latex-macros
  ;;         (concat calctex-additional-latex-macros
  ;;                 "\n\\let\\evalto\\Rightarrow")))
#+end_src

* Helps

** StackExchange Client
Why leave emacs just to browse helps.

*** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! sx)
#+end_src

*** Configuration
#+begin_src emacs-lisp
  (use-package! sx
    :commands
    (sx-ask
     sx-tab-all-questions
     sx-open-link
     sx-tab-unanswered-my-tags
     sx-inbox
     sx-search))
    ;; :config)
    ;; (bind-keys :prefix "C-c s"
    ;;            :prefix-map my-sx-map
    ;;            :prefix-docstring "Global keymap for SX."
    ;;            ("q" . sx-tab-all-questions)
    ;;            ("i" . sx-inbox)
    ;;            ("o" . sx-open-link)
    ;;            ("u" . sx-tab-unanswered-my-tags)
    ;;            ("a" . sx-ask)
    ;;            ("s" . sx-search)))
#+end_src

*** Keybindings
#+begin_src emacs-lisp
  (after! sx
    (evil-define-key 'normal
      sx-question-list-mode-map
      (kbd "<return>") 'sx-display
      (kbd "k") 'sx-question-list-previous
      (kbd "j") 'sx-question-list-next
      (kbd "A") 'sx-answer
      (kbd "C") 'sx-comment
      (kbd "D") 'sx-downvote
      (kbd "U") 'sx-upvote
      (kbd "E") 'sx-edit
      (kbd "W") 'sx-tab-week
      (kbd "g d") 'sx-visit-externally)
    (evil-define-key 'normal
      sx-question-mode-map
      (kbd "] ]") 'sx-question-mode-next-section
      (kbd "[ [") 'sx-question-mode-previous-section
      (kbd "g R") 'sx-question-mode-refresh))
#+end_src

*** COMMENT Authentication
This file is not included in the repo.
#+begin_src emacs-lisp
  (load-file (expand-file-name "personal/sxAuth.el" doom-private-dir))
#+end_src

Create it yourself: (The token could be provided by launching any =sx= Commands)
#+begin_export emacs-lisp
(after! sx
  (setq sx-auth-access-token "<your-token>"))
#+end_export

** Howdoyou

*** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! howdoyou)
#+end_src

*** Configuration
Package to search for help online.
#+begin_src emacs-lisp
  (use-package! howdoyou
    :commands howdoyou-query)
#+end_src

*** Keybindings
#+begin_src emacs-lisp
  (map! :map howdoyou-mode-map :n
        "q" #'quit-window
        "g ]" #'howdoyou-next-link
        "g [" #'howdoyou-previous-link
        "g r" #'howdoyou-reload-link
        "g R" #'howdoyou-go-back-to-first-link)
#+end_src

** Discover-my-major

*** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! discover-my-major)
#+end_src

*** Configuration
#+begin_src emacs-lisp
  (use-package! discover-my-major
    :commands (discover-my-major discover-my-mode))
#+end_src

* Miscellaneous

** Emacs Everywhere

*** Configuration
#+begin_src emacs-lisp
  (use-package! emacs-everywhere
    :commands emacs-everywhere
    :config
    (setq emacs-everywhere-markdown-windows '("Stack Exchange" "Stack Overflow" "Reddit" "Pull Request" "Issue" "Comparing .*\\.\\.\\." "Discord")
          emacs-everywhere-markdown-apps '("Discord")))
#+end_src

** System Packages Management

*** helm-system-package

**** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! helm-system-packages)
#+end_src

**** Configuration
#+begin_src emacs-lisp
  (use-package! helm-system-packages
    :commands helm-system-packages
    :config
    (require 'em-tramp)
    (setq password-cache t)
    (setq password-cache-expiry 3600))
#+end_src

*** System-Packages

**** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! system-packages)
#+end_src

**** Configuration
#+begin_src emacs-lisp
  (use-package! system-packages
    :defer t)
#+end_src

** COMMENT Drag-Stuff

*** Configuration
#+begin_src emacs-lisp
  (use-package! drag-stuff
    :config
    (drag-stuff-global-mode 1))
#+end_src

*** COMMENT Hydra Config
#+begin_src emacs-lisp
  (defhydra rz/drag-stuff (:color purple :timeout 4)
    "Move stuffs around"
    ("q" nil "quit" :exit t)
    ("j" drag-stuff-down "Down" :column "Lines")
    ("k" drag-stuff-up "Up")
    ("h" drag-stuff-left "Left" :column "Horizontal")
    ("l" drag-stuff-right "Right"))
#+end_src

** COMMENT HTOP (explain-pause-mode)

*** Configuration
#+begin_src emacs-lisp
  (use-package! explain-pause-mode
    :config
    (explain-pause-mode))
#+end_src

** Emacs wgrep

*** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! wgrep :recipe
       (:host github
        :repo "mhayashi1120/Emacs-wgrep"))
#+end_src

*** Configuration
#+begin_src emacs-lisp
  (use-package! wgrep)
#+end_src

** Auto-Minor-Mode

*** Configuration
#+begin_src emacs-lisp
  (use-package! auto-minor-mode)
#+end_src

*** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! auto-minor-mode)
#+end_src

** Link-Hint

*** Installation
#+begin_src emacs-lisp :tangle packages.el
  (package! link-hint)
#+end_src

*** Configuration
#+begin_src emacs-lisp
  (use-package! link-hint
    :defer t
    :config
    (setq browse-url-browser-function 'browse-url-generic)
    (setq browse-url-generic-program "librewolf")
    ;; Open urls in a new tab instead of window; can also be set in the config file
    (setq browse-url-generic-args '("--target" "tab"))
    (evil-define-key 'normal
      (kbd "SPC y") 'link-hint-copy-link
      (kbd "SPC F") 'link-hint-open-link)
    )
#+end_src
